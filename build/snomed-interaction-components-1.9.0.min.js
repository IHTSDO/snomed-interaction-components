/*! snomed-interaction-components 2014-07-08 */
function conceptDetails(a,b,c){"undefined"==typeof componentsRegistry&&(componentsRegistry=[]);var d=this;this.type="concept-details",this.conceptId=b,this.divElement=a,this.options=jQuery.extend(!0,{},c),this.attributesPId="",this.descsPId="",this.relsPId="",this.history=[],this.subscription=null;var e=null,f=null,g=0;componentLoaded=!1,$.each(componentsRegistry,function(a,b){b.divElement.id==d.divElement.id&&(componentLoaded=!0)}),0==componentLoaded&&componentsRegistry.push(d),this.getConceptId=function(){return this.conceptId},this.getDivId=function(){return this.divId},this.setupCanvas=function(){d.attributesPId=d.divElement.id+"-attributes-panel",d.descsPId=d.divElement.id+"-descriptions-panel",d.relsPId=d.divElement.id+"-rels-panel",d.childrenPId=d.divElement.id+"-children-panel",d.defaultTerm="",$(a).html();var b={divElementId:d.divElement.id};$.get("views/conceptDetailsPlugin/conceptDetailsPlugin-main.hbs").then(function(c){var e=Handlebars.compile(c);$(a).html(e(b)),$("#"+d.divElement.id+"-linkerButton").disableTextSelect(),$("#"+d.divElement.id+"-subscribersMarker").disableTextSelect(),$("#"+d.divElement.id+"-configButton").disableTextSelect(),$("#"+d.divElement.id+"-historyButton").disableTextSelect(),$("#"+d.divElement.id+"-collapseButton").disableTextSelect(),$("#"+d.divElement.id+"-expandButton").disableTextSelect(),$("#"+d.divElement.id+"-closeButton").disableTextSelect(),$("#"+d.divElement.id+"-expandButton").hide(),$("#"+d.divElement.id+"-subscribersMarker").hide(),$("#"+d.divElement.id+"-closeButton").click(function(){$(a).remove()}),"undefined"!=typeof d.options.closeButton&&0==d.options.closeButton&&$("#"+d.divElement.id+"-closeButton").hide(),"undefined"!=typeof d.options.linkerButton&&0==d.options.linkerButton&&$("#"+d.divElement.id+"-linkerButton").hide(),"undefined"!=typeof d.options.subscribersMarker&&0==d.options.subscribersMarker&&$("#"+d.divElement.id+"-subscribersMarker").remove(),"undefined"!=typeof d.options.collapseButton&&0==d.options.collapseButton&&($("#"+d.divElement.id+"-expandButton").hide(),$("#"+d.divElement.id+"-collapseButton").hide()),$("#"+d.divElement.id+"-expandButton").click(function(){$("#"+d.divElement.id+"-panelBody").slideDown("fast"),$("#"+d.divElement.id+"-expandButton").hide(),$("#"+d.divElement.id+"-collapseButton").show(),$("#"+d.divElement.id+"-panelTitle").html("&nbsp&nbsp&nbsp<strong>Concept Details</strong>")}),$("#"+d.divElement.id+"-collapseButton").click(function(){$("#"+d.divElement.id+"-panelBody").slideUp("fast"),$("#"+d.divElement.id+"-expandButton").show(),$("#"+d.divElement.id+"-collapseButton").hide(),$("#"+d.divElement.id+"-panelTitle").html("&nbsp&nbsp&nbsp<strong>Concept Details: "+d.defaultTerm+"</strong>")}),$("#"+d.divElement.id).click(function(a){$(a.target).hasClass("glyphicon")||$("#"+d.divElement.id).find(".more-fields-button").popover("hide")}),$("#"+d.divElement.id+"-historyButton").click(function(){$("#"+d.divElement.id+"-historyButton").popover({trigger:"manual",placement:"bottomRight",html:!0,content:function(){var a='<div style="height:100px;overflow:auto;">';a+="<table>";var b=d.history.slice(0);return b.reverse(),$.each(b,function(b,c){var e=new Date,f=e.getTime(),g=f-c.time,h="";6e4>g?h=1==Math.round(g/1e3)?Math.round(g/1e3)+" second ago":Math.round(g/1e3)+" seconds ago":36e5>g?h=1==Math.round(g/1e3/60)?Math.round(g/1e3/60)+" minute ago":Math.round(g/1e3/60)+" minutes ago":216e6>g&&(h=1==Math.round(g/1e3/60/60)?Math.round(g/1e3/60/60)+" hour ago":Math.round(g/1e3/60/60)+" hours ago"),a=a+'<tr><td><a href="javascript:void(0);" onclick="updateCD(\''+d.divElement.id+"',"+c.conceptId+');">'+c.defaultTerm+"</a>",a=a+' <span class="text-muted" style="font-size: 80%"><em>'+h+"<em></span>",a+="</td></tr>"}),a+="</table>",a+="</div>"}}),$("#"+d.divElement.id+"-historyButton").popover("toggle")}),"undefined"==typeof i18n_panel_options&&(i18n_panel_options="Panel options"),$("#"+d.divElement.id+"-configButton").tooltip({placement:"left",trigger:"hover",title:i18n_panel_options,animation:!0,delay:1e3}),"undefined"==typeof i18n_history&&(i18n_history="History"),$("#"+d.divElement.id+"-historyButton").tooltip({placement:"left",trigger:"hover",title:i18n_history,animation:!0,delay:1e3}),"undefined"==typeof i18n_panel_links&&(i18n_panel_links="Panel links"),$("#"+d.divElement.id+"-linkerButton").tooltip({placement:"left",trigger:"hover",title:i18n_panel_links,animation:!0,delay:1e3}),$("#"+d.divElement.id+"-apply-button").click(function(){d.readOptionsPanel(),d.updateCanvas()}),$("#"+d.divElement.id+"-linkerButton").draggable({cancel:!1,appendTo:"body",helper:"clone",delay:500}),$(".resizable").resizable(),$("#"+d.divElement.id+"-panelHeading").droppable({drop:d.handleDropEvent,hoverClass:"bg-info"}),$("#"+d.divElement.id+"-linkerButton").click(function(){$("#"+d.divElement.id+"-linkerButton").popover({trigger:"manual",placement:"bottomRight",html:!0,content:function(){return linkerHtml=d.subscription?'<div class="text-center"><a href="javascript:void(0);" onclick="cancelSubscription(\''+d.subscription.divElement.id+"','"+d.divElement.id+"');\">Clear link</a></div>":'<div class="text-center text-muted"><em>Not linked yet<br>Drag to link with other panels</em></div>'}}),$("#"+d.divElement.id+"-linkerButton").popover("toggle")}),d.updateCanvas(),d.setupOptionsPanel()})},this.handleDropEvent=function(a,b){var c=b.draggable;c.attr("data-concept-id")?d.conceptId!=c.attr("data-concept-id")&&($.contains($("#"+d.divElement.id).get(0),$(c).get(0))&&c.remove(),d.conceptId=c.attr("data-concept-id"),d.updateCanvas()):c.attr("data-panel")&&$.each(componentsRegistry,function(a,b){b.divElement.id==c.attr("data-panel")&&("search"==b.type||"taxonomy"==b.type)&&b.subscribe(d)})},this.updateCanvas=function(){$(".more-fields-button").popover("hide"),g!=d.conceptId&&(g=d.conceptId,$("#"+d.attributesPId).html("<i class='glyphicon glyphicon-refresh icon-spin'></i>"),$("#home-attributes-"+d.divElement.id).html("<i class='glyphicon glyphicon-refresh icon-spin'></i>"),$("#"+d.descsPId).html("<i class='glyphicon glyphicon-refresh icon-spin'></i>"),$("#"+d.relsPId).html("<i class='glyphicon glyphicon-refresh icon-spin'></i>"),$("#home-parents-"+d.divElement.id).html("<i class='glyphicon glyphicon-refresh icon-spin'></i>"),$("#home-roles-"+d.divElement.id).html("<i class='glyphicon glyphicon-refresh icon-spin'></i>"),$("#"+d.childrenPId).html("<i class='glyphicon glyphicon-refresh icon-spin'></i>"),$("#diagram-canvas-"+d.divElement.id).html("<i class='glyphicon glyphicon-refresh icon-spin'></i>"),$("#refsets-"+d.divElement.id).html("<i class='glyphicon glyphicon-refresh icon-spin'></i>"),null!=e&&(e.abort(),console.log("aborting call...")),e=$.getJSON(c.serverUrl+"/"+c.edition+"/"+c.release+"/concepts/"+d.conceptId,function(){}).done(function(b){var c=b;e=null,d.attributesPId=a.id+"-attributes-panel",d.defaultTerm=c.defaultTerm;var f=new Date,h=f.getTime();d.history.push({defaultTerm:c.defaultTerm,conceptId:c.conceptId,time:h});var i="";i+="<table class='table table-default' >",i+="<tr ",c.effectiveTime==d.options.highlightByEffectiveTime&&(i+="class = 'highlightEffectiveTime'"),i+="><td>",i+="<h4>",i="Primitive"==c.definitionStatus?i+'<a href="javascript:void(0);" style="color: inherit;text-decoration: inherit;"><span class="badge alert-warning jqui-draggable"  data-concept-id="'+c.conceptId+'" data-term="'+c.defaultTerm+'" data-def-status="'+c.definitionStatus+'">&nbsp;</span></a>&nbsp;&nbsp;':i+'<a href="javascript:void(0);" style="color: inherit;text-decoration: inherit;"><span class="badge alert-warning jqui-draggable"  data-concept-id="'+c.conceptId+'" data-term="'+c.defaultTerm+'" data-def-status="'+c.definitionStatus+'">&equiv;</span></a>&nbsp;&nbsp;',i=i+"<span class='jqui-droppable'>"+c.defaultTerm+"</span></h4>",i=i+"<br>SCTID: "+c.conceptId,i+="Primitive"==c.definitionStatus?", <span class='i18n' data-i18n-id='i18n_primitive'>Primitive</span>":", <span class='i18n' data-i18n-id='i18n_fully_defined'>Fully defined</span>",i+=1==c.active?", <span class='i18n' data-i18n-id='i18n_active'>Active</span>":", <span class='i18n' data-i18n-id='i18n_inactive'>Inactive</span>",i+="</td>";var j="<table border='1'><tr><th style='padding: 3px;'>Effective Time</th><th style='padding: 3px;'>ModuleId</th></tr><tr><td style='padding: 3px;'>"+c.effectiveTime+"</td><td style='padding: 3px;'>"+c.module+"</td></tr></table>";i=i+'<td><button type="button" class="btn btn-link unobtrusive-icon more-fields-button pull-right" data-container="body" data-toggle="popover" data-placement="left" data-content="'+j+'" data-html="true"><i class="glyphicon glyphicon-info-sign"></i></button>';var k="<form><input class='form-control' id='share-field-"+d.divElement.id+"' value='"+document.URL.split("?")[0].split("#")[0]+"?perspective=full&conceptId1="+d.conceptId+"'></form><br>Copy the concept link (e.g. CTRL-C) to save and share a reference to this concept.";i=i+'&nbsp;<button type="button" id="share-link-'+d.divElement.id+'" class="btn btn-link more-fields-button pull-right" data-container="body" data-toggle="popover" data-placement="left" data-content="'+k+'" data-html="true"><i class="glyphicon glyphicon-share-alt"></i></button></td>',i+="</tr></table>",$("#"+d.attributesPId).html(i),$("#share-link-"+d.divElement.id).disableTextSelect(),$("#share-link-"+d.divElement.id).click(function(){setTimeout(function(){$("#share-field-"+d.divElement.id).select()},300)});var l="";l="Primitive"==c.definitionStatus?l+'<h4><a href="javascript:void(0);" style="color: inherit;text-decoration: inherit;"><span class="badge alert-warning jqui-draggable"  data-concept-id="'+c.conceptId+'" data-term="'+c.defaultTerm+'" data-def-status="'+c.definitionStatus+'">&nbsp;</span></a>&nbsp;&nbsp;<span class="jqui-droppable">':l+'<h4><a href="javascript:void(0);" style="color: inherit;text-decoration: inherit;"><span class="badge alert-warning jqui-draggable"  data-concept-id="'+c.conceptId+'" data-term="'+c.defaultTerm+'" data-def-status="'+c.definitionStatus+'">&equiv;</span></a>&nbsp;&nbsp;<span class="jqui-droppable">',l=l+c.defaultTerm+"</span></h4>",l=l+"<h5>SCTID: "+c.conceptId+"</h5>",l=l+'<div id="home-descriptions-'+d.divElement.id+'"></div>',$("#home-attributes-"+d.divElement.id).html(l),c.active?$("#home-attributes-"+d.divElement.id).css("background-color","white"):$("#home-attributes-"+d.divElement.id).css("background-color","LightPink"),$("#"+d.divElement.id+"-expandButton").is(":visible")&&$("#"+d.divElement.id+"-panelTitle").html("&nbsp;&nbsp;&nbsp;<strong>Concept Details: "+d.defaultTerm+"</strong>"),$("#"+d.attributesPId+",#home-attributes-"+d.divElement.id).find(".jqui-droppable").droppable({drop:d.handleDropEvent,hoverClass:"bg-info"}),$("#"+d.attributesPId+",#home-attributes-"+d.divElement.id).find(".jqui-draggable").draggable({appendTo:"body",helper:"clone",delay:10}),"undefined"==typeof i18n_drag_this&&(i18n_drag_this="Drag this"),$("#"+d.attributesPId+",#home-attributes-"+d.divElement.id).find(".jqui-draggable").tooltip({placement:"left auto",trigger:"hover",title:i18n_drag_this,animation:!0,delay:500}),d.descsPId=a.id+"-descriptions-panel";var m="";"900000000000508004"==d.options.langRefset?m="(GB)":"900000000000509007"==d.options.langRefset?m="(US)":"450828004"==d.options.langRefset?m="(ES)":"554461000005103"==d.options.langRefset&&(m="(DA)");var n="<table class='table table-bordered' id = '"+d.descsPId+"-table'>";n+="<thead><tr>",n+="<th><span class='i18n' data-i18n-id='i18n_term'>Term</span></th>",1==d.options.showIds&&(n+="<th>SCTID</th>"),n=n+"<th><span class='i18n' data-i18n-id='i18n_acceptability'>Acceptability</span> "+m+"</th>",n+="</tr></thead><tbody>";var o=c.descriptions.slice(0);o.sort(function(a,b){if(a.type.conceptId<b.type.conceptId)return-1;if(a.type.conceptId>b.type.conceptId)return 1;if(a.type.conceptId==b.type.conceptId){if(a.term<b.term)return-1;if(a.term>b.term)return 1}return 0});var p="";$.each(o,function(a,b){if(d.options.displayInactiveDescriptions||1==b.active){1==b.active&&(""!=p&&(p+="<br>"),p=p+"&nbsp;&nbsp;&nbsp;&nbsp;"+b.term);var c="",e=!1,f=!1,g=!1,h=!1,i=!1;"900000000000003001"==b.type.conceptId?e=!0:"900000000000013009"==b.type.conceptId?f=!0:"900000000000550004"==b.type.conceptId&&(g=!0),"undefined"!=typeof b.langMemberships&&$.each(b.langMemberships,function(a,b){b.refset.conceptId==d.options.langRefset&&"900000000000548007"==b.acceptability.conceptId?h=!0:b.refset.conceptId==d.options.langRefset&&"900000000000549004"==b.acceptability.conceptId&&(i=!0)}),c="<tr class='",c+=e?" fsn-row":" synonym-row",b.active||(c+=" danger"),b.effectiveTime==d.options.highlightByEffectiveTime&&(c+=" highlightEffectiveTime"),c+="'><td>","undefined"==typeof i18n_fsn&&(i18n_fsn="F"),"undefined"==typeof i18n_synonym&&(i18n_synonym="S"),"undefined"==typeof i18n_definition&&(i18n_definition="D"),e?c=c+'<span rel="tooltip-right" title="'+i18n_fsn+'">F</span>':f?c=c+'<span rel="tooltip-right" title="'+i18n_synonym+'">S</span>':g&&(c=c+'<span rel="tooltip-right" title="'+i18n_definition+'">D</span>'),c+=h&&e?'&nbsp;<span class="glyphicon glyphicon-star-empty" rel="tooltip-right" title="Preferred"></span>':h&&!e?'&nbsp;<span class="glyphicon glyphicon-star" rel="tooltip-right" title="Preferred"></span>':i?'&nbsp;<span rel="tooltip-right" title="Acceptable">&#10004;</span></span>':"&nbsp;&nbsp;&nbsp;",c=c+"&nbsp;&nbsp;&nbsp;"+b.term+"</td>",1==d.options.showIds&&(c=c+"<td>"+b.descriptionId+"</td>");var j=!1;"undefined"!=typeof b.langMemberships&&$.each(b.langMemberships,function(a,b){b.refset.conceptId==d.options.langRefset&&(c+="900000000000548007"==b.acceptability.conceptId?"<td><span class='i18n' data-i18n-id='i18n_preferred'>Preferred</span>":"<td><span class='i18n' data-i18n-id='i18n_acceptable'>Acceptable</span>",j=!0)}),0==j&&(c+="<td><span class='i18n' data-i18n-id='i18n_not_acceptable'>Not acceptable</span>");var k="<table border='1'><tr><th style='padding: 3px;'>DescriptionId</th><th style='padding: 3px;'>Type</th><th style='padding: 3px;'>Language</th><th style='padding: 3px;'>Case Significance</th><th style='padding: 3px;'>Effective Time</th><th style='padding: 3px;'>ModuleId</th></tr>";k=k+"<tr><td style='padding: 3px;'>"+b.descriptionId+"</td><td style='padding: 3px;'>"+d.removeSemtag(b.type.defaultTerm)+"</td><td style='padding: 3px;'>"+b.lang+"</td><td style='padding: 3px;'>"+d.removeSemtag(b.ics.defaultTerm)+"</td><td style='padding: 3px;'>"+b.effectiveTime+"</td><td style='padding: 3px;'>"+b.module+"</td></tr></table>",c=c+'<button type="button" class="btn btn-link unobtrusive-icon more-fields-button pull-right" data-container="body" data-toggle="popover" data-placement="left" data-content="'+k+'" data-html="true"><i class="glyphicon glyphicon-info-sign"></i></button>',c+="</td></tr>",(0!=j||!d.options.hideNotAcceptable||d.options.displayInactiveDescriptions)&&(n+=c)}}),n+="</tbody></table>",$("#"+d.descsPId).html(n),d.options.displaySynonyms&&$("#home-descriptions-"+d.divElement.id).html(p),1!=d.options.displaySynonyms&&($("#"+d.descsPId).find(".synonym-row").each(function(a,b){$(b).toggle()}),$(this).toggleClass("glyphicon-plus"),$(this).toggleClass("glyphicon-minus")),$("#"+d.descsPId+"-descButton").disableTextSelect(),$("#"+d.descsPId+"-descButton").click(function(){table=$(this).closest("table").first(),$(this).toggleClass("glyphicon-plus"),$(this).toggleClass("glyphicon-minus"),table.find(".synonym-row").each(function(a,b){$(b).toggle()})}),$("#"+d.descsPId).find(".jqui-draggable").draggable({appendTo:"body",helper:"clone",delay:500}),$("#"+d.descsPId).find("[rel=tooltip-right]").tooltip({placement:"right"}),"inferred"==d.options.selectedView?($("#home-"+d.divElement.id+"-viewLabel").html("<span class='i18n' data-i18n-id='i18n_inferred_view'>Inferred view</span>"),$("#home-"+d.divElement.id+"-diagram-viewLabel").html("<span class='i18n' data-i18n-id='i18n_inferred_view'>Inferred view</span>")):($("#home-"+d.divElement.id+"-viewLabel").html("<span class='i18n' data-i18n-id='i18n_stated_view'>Stated view</span>"),$("#home-"+d.divElement.id+"-diagram-viewLabel").html("<span class='i18n' data-i18n-id='i18n_stated_view'>Stated view</span>")),d.relsPId=a.id+"-rels-panel";var q=[],r=[],s=[],t=[],u="<table class='table table-bordered'>";u+="<thead><tr>",u+="<th><span class='i18n' data-i18n-id='i18n_type'>Type</span></th>",u+="<th><span class='i18n' data-i18n-id='i18n_destination'>Destination</span></th>",u+="<th><span class='i18n' data-i18n-id='i18n_group'>Group</span></th>",u+="<th><span class='i18n' data-i18n-id='i18n_char_type'>CharType</span></th>",u+="</tr></thead><tbody>","undefined"!=typeof c.relationships&&(c.relationships.sort(function(a,b){return a.groupId<b.groupId?-1:a.groupId>b.groupId?1:116680003==a.type.conceptId?-1:116680003==b.type.conceptId?1:a.target.defaultTerm<b.target.defaultTerm?-1:a.target.defaultTerm>b.target.defaultTerm?1:0}),$.each(c.relationships,function(a,b){if(1==b.active){116680003==b.type.conceptId?r.push(b):t.push(b);var c="";c="<tr class='inferred-rel",b.effectiveTime==d.options.highlightByEffectiveTime&&(c+=" highlightEffectiveTime"),c+="'>",c+="<td>",c="Primitive"==b.type.definitionStatus?c+'<a href="javascript:void(0);" style="color: inherit;text-decoration: inherit;"><span class="badge alert-warning jqui-draggable"  data-concept-id="'+b.type.conceptId+'" data-term="'+b.type.defaultTerm+'" data-def-status="'+b.type.definitionStatus+'">&nbsp;</span></a>&nbsp;&nbsp;':c+'<a href="javascript:void(0);" style="color: inherit;text-decoration: inherit;"><span class="badge alert-warning jqui-draggable"  data-concept-id="'+b.type.conceptId+'" data-term="'+b.type.defaultTerm+'" data-def-status="'+b.type.definitionStatus+'">&equiv;</span></a>&nbsp;&nbsp;',c=c+b.type.defaultTerm+"</td>",c+="<td>",c="Primitive"==b.target.definitionStatus?c+'<a href="javascript:void(0);" style="color: inherit;text-decoration: inherit;"><span class="badge alert-warning jqui-draggable"  data-concept-id="'+b.target.conceptId+'" data-term="'+b.target.defaultTerm+'" data-def-status="'+b.target.definitionStatus+'">&nbsp;</span></a>&nbsp;&nbsp;':c+'<a href="javascript:void(0);" style="color: inherit;text-decoration: inherit;"><span class="badge alert-warning jqui-draggable"  data-concept-id="'+b.target.conceptId+'" data-term="'+b.target.defaultTerm+'" data-def-status="'+b.target.definitionStatus+'">&equiv;</span></a>&nbsp;&nbsp;',c=c+b.target.defaultTerm+"</td>",c=c+"<td>"+b.groupId+"</td>",c+="900000000000010007"==b.charType.conceptId?"<td><span class='i18n' data-i18n-id='i18n_stated'>Stated</span>":"900000000000011006"==b.charType.conceptId?"<td><span class='i18n' data-i18n-id='i18n_inferred'>Inferred</span>":"<td><span class='i18n' data-i18n-id='i18n_other'>Other</span>";var e="<table border='1'><tr><th style='padding: 3px;'>TypeId</th><th style='padding: 3px;'>TargetId</th><th style='padding: 3px;'>Modifier</th><th style='padding: 3px;'>Effective Time</th><th style='padding: 3px;'>ModuleId</th></tr>";e=e+"<tr><td style='padding: 3px;'>"+b.type.conceptId+"</td><td style='padding: 3px;'>"+b.target.conceptId+"</td><td style='padding: 3px;'>"+b.modifier+"</td><td style='padding: 3px;'>"+b.effectiveTime+"</td><td style='padding: 3px;'>"+b.module+"</td></tr></table>",c=c+'<button type="button" class="btn btn-link unobtrusive-icon more-fields-button pull-right" data-container="body" data-toggle="popover" data-placement="left" data-content="'+e+'" data-html="true"><i class="glyphicon glyphicon-info-sign"></i></button>',c+="</td></tr>",u+=c}})),"undefined"!=typeof c.statedRelationships&&(c.statedRelationships.sort(function(a,b){return a.groupId<b.groupId?-1:a.groupId>b.groupId?1:116680003==a.type.conceptId?-1:116680003==b.type.conceptId?1:a.target.defaultTerm<b.target.defaultTerm?-1:a.target.defaultTerm>b.target.defaultTerm?1:0}),$.each(c.statedRelationships,function(a,b){if(1==b.active){116680003==b.type.conceptId?q.push(b):s.push(b);var c="";c="<tr class='stated-rel",b.effectiveTime==d.options.highlightByEffectiveTime&&(c+=" highlightEffectiveTime"),c+="'>",c+="<td>",c="Primitive"==b.type.definitionStatus?c+'<a href="javascript:void(0);" style="color: inherit;text-decoration: inherit;"><span class="badge alert-warning jqui-draggable"  data-concept-id="'+b.type.conceptId+'" data-term="'+b.type.defaultTerm+'" data-def-status="'+b.type.definitionStatus+'">&nbsp;</span></a>&nbsp;&nbsp;':c+'<a href="javascript:void(0);" style="color: inherit;text-decoration: inherit;"><span class="badge alert-warning jqui-draggable"  data-concept-id="'+b.type.conceptId+'" data-term="'+b.type.defaultTerm+'" data-def-status="'+b.type.definitionStatus+'">&equiv;</span></a>&nbsp;&nbsp;',c=c+b.type.defaultTerm+"</td>",c+="<td>",c="Primitive"==b.target.definitionStatus?c+'<a href="javascript:void(0);" style="color: inherit;text-decoration: inherit;"><span class="badge alert-warning jqui-draggable"  data-concept-id="'+b.target.conceptId+'" data-term="'+b.target.defaultTerm+'" data-def-status="'+b.target.definitionStatus+'">&nbsp;</span></a>&nbsp;&nbsp;':c+'<a href="javascript:void(0);" style="color: inherit;text-decoration: inherit;"><span class="badge alert-warning jqui-draggable"  data-concept-id="'+b.target.conceptId+'" data-term="'+b.target.defaultTerm+'" data-def-status="'+b.target.definitionStatus+'">&equiv;</span></a>&nbsp;&nbsp;',c=c+b.target.defaultTerm+"</td>",c=c+"<td>"+b.groupId+"</td>",c+="900000000000010007"==b.charType.conceptId?"<td><span class='i18n' data-i18n-id='i18n_stated'>Stated</span>":"900000000000011006"==b.charType.conceptId?"<td><span class='i18n' data-i18n-id='i18n_inferred'>Inferred</span>":"<td><span class='i18n' data-i18n-id='i18n_other'>Other</span>";var e="<table border='1'><tr><th style='padding: 3px;'>Modifier</th><th style='padding: 3px;'>Effective Time</th><th style='padding: 3px;'>ModuleId</th></tr>";e=e+"<tr><td style='padding: 3px;'>"+b.modifier+"</td><td style='padding: 3px;'>"+b.effectiveTime+"</td><td style='padding: 3px;'>"+b.module+"</td></tr></table>",c=c+'<button type="button" class="btn btn-link unobtrusive-icon more-fields-button pull-right" data-container="body" data-toggle="popover" data-placement="left" data-content="'+e+'" data-html="true"><i class="glyphicon glyphicon-info-sign"></i></button>',c+="</td></tr>",u+=c}})),r.length+q.length==0&&(u+="<tr><td colspan='4'><span class='text-muted'>No relationships</span></td></tr>"),u+="</tbody></table>",$("#"+d.relsPId).html(u),r.sort(function(a,b){return a.target.defaultTerm<b.target.defaultTerm?-1:a.target.defaultTerm>b.target.defaultTerm?1:0}),q.sort(function(a,b){return a.target.defaultTerm<b.target.defaultTerm?-1:a.target.defaultTerm>b.target.defaultTerm?1:0}),t.sort(function(a,b){return a.groupId<b.groupId?-1:a.groupId>b.groupId?1:a.target.defaultTerm<b.target.defaultTerm?-1:a.target.defaultTerm>b.target.defaultTerm?1:0}),s.sort(function(a,b){return a.groupId<b.groupId?-1:a.groupId>b.groupId?1:a.target.defaultTerm<b.target.defaultTerm?-1:a.target.defaultTerm>b.target.defaultTerm?1:0});var v="";"stated"==d.options.selectedView?($.each(q,function(a,b){v=v+"<span class='jqui-draggable text-warning' data-concept-id='"+b.type.conceptId+"' data-term='"+b.type.defaultTerm+"'>",v=b.type.defaultTerm.lastIndexOf("(")>0?v+b.type.defaultTerm.substr(0,b.type.defaultTerm.lastIndexOf("(")-1)+"</span>&nbsp&rArr;&nbsp;":v+b.type.defaultTerm+"</span>&nbsp&rArr;&nbsp;",v+="<span class='jqui-draggable",v+="Primitive"==b.target.definitionStatus?" sct-primitive-concept-compact":" sct-defined-concept-compact",v=v+"' data-concept-id='"+b.target.conceptId+"' data-term='"+b.target.defaultTerm+"'>",v=b.target.defaultTerm.lastIndexOf("(")>0?v+b.target.defaultTerm.substr(0,b.target.defaultTerm.lastIndexOf("(")-1)+"</span><br>":v+b.target.defaultTerm+"</span><br>"}),0==q.length&&(v+="<span class='text-muted'>No parents</span>")):($.each(r,function(a,b){v=v+"<span class='jqui-draggable text-warning' data-concept-id='"+b.type.conceptId+"' data-term='"+b.type.defaultTerm+"'>",v=b.type.defaultTerm.lastIndexOf("(")>0?v+b.type.defaultTerm.substr(0,b.type.defaultTerm.lastIndexOf("(")-1)+"</span>&nbsp&rArr;&nbsp;":v+b.type.defaultTerm+"</span>&nbsp&rArr;&nbsp;",v+="<span class='jqui-draggable",v+="Primitive"==b.target.definitionStatus?" sct-primitive-concept-compact":" sct-defined-concept-compact",v=v+"' data-concept-id='"+b.target.conceptId+"' data-term='"+b.target.defaultTerm+"'>",v=b.target.defaultTerm.lastIndexOf("(")>0?v+b.target.defaultTerm.substr(0,b.target.defaultTerm.lastIndexOf("(")-1)+"</span><br>":v+b.target.defaultTerm+"</span><br>"}),0==r.length&&(v+="<span class='text-muted'>No parents</span>")),d.options.diagrammingMarkupEnabled||(v=d.stripDiagrammingMarkup(v)),$("#home-parents-"+d.divElement.id).html(v);var w="<div style='line-height: 100%;'>";if("stated"==d.options.selectedView){var x=0,y="",z="white";$.each(s,function(a,b){x!=b.groupId&&(w+="<br>",x=b.groupId,z=getRandomColor(),y="&nbsp;&nbsp;&nbsp;<span style='background-color: "+z+"'>&nbsp;&nbsp;</span>"),w+=y,w=w+"&nbsp;<span class='jqui-draggable sct-attribute-compact' data-concept-id='"+b.type.conceptId+"' data-term='"+b.type.defaultTerm+"'>",w=w+d.removeSemtag(b.type.defaultTerm)+"</span>&nbsp&rarr;&nbsp;",w+="<span class='jqui-draggable",w+="Primitive"==b.target.definitionStatus?" sct-primitive-concept-compact":" sct-defined-concept-compact",w=w+"' data-concept-id='"+b.target.conceptId+"' data-term='"+b.target.defaultTerm+"'>",w=w+d.removeSemtag(b.target.defaultTerm)+"</span><br>"}),0==s.length&&(w+="<span class='i18n text-muted' data-i18n-id='i18n_no_relationships'>No relationships</span>")}else{var x=0,y="",z="white";$.each(t,function(a,b){x!=b.groupId&&(x=b.groupId,w+="<br>",z=getRandomColor(),y="&nbsp;&nbsp;&nbsp;<span style='background-color: "+z+"'>&nbsp;&nbsp;</span>"),w+=y,w=w+"&nbsp;<span class='jqui-draggable sct-attribute-compact' data-concept-id='"+b.type.conceptId+"' data-term='"+b.type.defaultTerm+"'>",w=w+d.removeSemtag(b.type.defaultTerm)+"</span>&nbsp&rarr;&nbsp;",w+="<span class='jqui-draggable",w+="Primitive"==b.target.definitionStatus?" sct-primitive-concept-compact":" sct-defined-concept-compact",w=w+"' data-concept-id='"+b.target.conceptId+"' data-term='"+b.target.defaultTerm+"'>",w=w+d.removeSemtag(b.target.defaultTerm)+"</span><br>"}),0==t.length&&(w+="<span class='i18n text-muted' data-i18n-id='i18n_no_relationships'>No relationships</span>")}w+="</div>",d.options.diagrammingMarkupEnabled||(w=d.stripDiagrammingMarkup(w)),$("#footer-"+d.divElement.id).html(d.options.diagrammingMarkupEnabled?'<a href="http://www.ihtsdo.org/fileadmin/user_upload/Docs_01/Publications/SNOMED_CT_Diagramming_Guideline.pdf" target="_blank">Read about the IHTSDO Diagramming Guideline</a>':""),$("#home-roles-"+d.divElement.id).html(w);var A="";if(c.memberships){var B=!1,C="<table class='table table-bordered'>";C+="<thead><tr>",C+="<th><span class='i18n' data-i18n-id='i18n_simple_refset_memberships'>Simple Refsets Memberships</span></th>",C+="</tr></thead><tbody>",$.each(c.memberships,function(a,b){if("SIMPLE_REFSET"==b.type){B=!0,C+="<tr class='",b.active||(C+=" danger"),C+="'><td>",C="Primitive"==b.refset.definitionStatus?C+'<a href="javascript:void(0);" style="color: inherit;text-decoration: inherit;"><span class="badge alert-warning jqui-draggable"  data-concept-id="'+b.refset.conceptId+'" data-term="'+b.refset.defaultTerm+'" data-def-status="'+b.refset.definitionStatus+'">&nbsp;</span></a>&nbsp;&nbsp;':C+'<a href="javascript:void(0);" style="color: inherit;text-decoration: inherit;"><span class="badge alert-warning jqui-draggable"  data-concept-id="'+b.refset.conceptId+'" data-term="'+b.refset.defaultTerm+'" data-def-status="'+b.refset.definitionStatus+'">&equiv;</span></a>&nbsp;&nbsp;',C=C+b.refset.defaultTerm+"</td>";var c="<table border='1'><tr><th style='padding: 3px;'>RefsetId</th><th style='padding: 3px;'>Effective Time</th><th style='padding: 3px;'>ModuleId</th></tr>";c=c+"<tr><td style='padding: 3px;'>"+b.refset.conceptId+"</td><td style='padding: 3px;'>"+b.effectiveTime+"</td><td style='padding: 3px;'>"+b.module+"</td></tr></table>",C=C+'<button type="button" class="btn btn-link unobtrusive-icon more-fields-button pull-right" data-container="body" data-toggle="popover" data-placement="left" data-content="'+c+'" data-html="true"><i class="glyphicon glyphicon-info-sign"></i></button>',C+="</td></tr>"}}),B?(C+="</tbody></table>",A+=C):(C+="<tr><td><span class='i18n text-muted' data-i18n-id='i18n_no_memberships'>No memberships</span></td></tr>",C+="</tbody></table>");var D=!1,E="<table class='table table-bordered'>";E+="<thead><tr>",E+="<th><span class='i18n' data-i18n-id='i18n_simple_map_refset_name'>Simple Map Refset name</span></th>",E+="<th><span class='i18n' data-i18n-id='i18n_target_code'>Target code</span></th>",E+="</tr></thead><tbody>",$.each(c.memberships,function(a,b){if("SIMPLEMAP"==b.type){D=!0,E+="<tr class='",b.active||(E+=" danger"),E+="'><td>",E="Primitive"==b.refset.definitionStatus?E+'<a href="javascript:void(0);" style="color: inherit;text-decoration: inherit;"><span class="badge alert-warning jqui-draggable"  data-concept-id="'+b.refset.conceptId+'" data-term="'+b.refset.defaultTerm+'" data-def-status="'+b.refset.definitionStatus+'">&nbsp;</span></a>&nbsp;&nbsp;':E+'<a href="javascript:void(0);" style="color: inherit;text-decoration: inherit;"><span class="badge alert-warning jqui-draggable"  data-concept-id="'+b.refset.conceptId+'" data-term="'+b.refset.defaultTerm+'" data-def-status="'+b.refset.definitionStatus+'">&equiv;</span></a>&nbsp;&nbsp;',E=E+b.refset.defaultTerm+"</td>",E=E+"<td>"+b.otherValue;var c="<table border='1'><tr><th style='padding: 3px;'>RefsetId</th><th style='padding: 3px;'>Effective Time</th><th style='padding: 3px;'>ModuleId</th></tr>";c=c+"<tr><td style='padding: 3px;'>"+b.refset.conceptId+"</td><td style='padding: 3px;'>"+b.effectiveTime+"</td><td style='padding: 3px;'>"+b.module+"</td></tr></table>",E=E+'<button type="button" class="btn btn-link unobtrusive-icon more-fields-button pull-right" data-container="body" data-toggle="popover" data-placement="left" data-content="'+c+'" data-html="true"><i class="glyphicon glyphicon-info-sign"></i></button>',E+="</td></tr>"}}),D?(E+="</tbody></table>",A+=E):(E+="<tr><td colspan='2'><span class='i18n text-muted' data-i18n-id='i18n_no_memberships'>No memberships</span></td></tr>",E+="</tbody></table>");var F=!1,G="<table class='table table-bordered'>";G+="<thead><tr>",G+="<th><span class='i18n' data-i18n-id='i18n_attribute_value_refset_name'>Attribute Value Refset name</span></th>",G+="<th><span class='i18n' data-i18n-id='i18n_value'>Value</span></th>",G+="</tr></thead><tbody>",$.each(c.memberships,function(a,b){if("ATTRIBUTE_VALUE"==b.type){F=!0,G+="<tr class='",b.active||(G+=" danger"),G+="'><td>",G="Primitive"==b.refset.definitionStatus?G+'<a href="javascript:void(0);" style="color: inherit;text-decoration: inherit;"><span class="badge alert-warning jqui-draggable"  data-concept-id="'+b.refset.conceptId+'" data-term="'+b.refset.defaultTerm+'" data-def-status="'+b.refset.definitionStatus+'">&nbsp;</span></a>&nbsp;&nbsp;':G+'<a href="javascript:void(0);" style="color: inherit;text-decoration: inherit;"><span class="badge alert-warning jqui-draggable"  data-concept-id="'+b.refset.conceptId+'" data-term="'+b.refset.defaultTerm+'" data-def-status="'+b.refset.definitionStatus+'">&equiv;</span></a>&nbsp;&nbsp;',G=G+b.refset.defaultTerm+"</td>",G+="<td>",G="Primitive"==b.cidValue.definitionStatus?G+'<a href="javascript:void(0);" style="color: inherit;text-decoration: inherit;"><span class="badge alert-warning jqui-draggable"  data-concept-id="'+b.cidValue.conceptId+'" data-term="'+b.cidValue.defaultTerm+'" data-def-status="'+b.cidValue.definitionStatus+'">&nbsp;</span></a>&nbsp;&nbsp;':G+'<a href="javascript:void(0);" style="color: inherit;text-decoration: inherit;"><span class="badge alert-warning jqui-draggable"  data-concept-id="'+b.cidValue.conceptId+'" data-term="'+b.cidValue.defaultTerm+'" data-def-status="'+b.cidValue.definitionStatus+'">&equiv;</span></a>&nbsp;&nbsp;',G=G+b.cidValue.defaultTerm+"</td>";
var c="<table border='1'><tr><th style='padding: 3px;'>RefsetId</th><th style='padding: 3px;'>Effective Time</th><th style='padding: 3px;'>ModuleId</th></tr>";c=c+"<tr><td style='padding: 3px;'>"+b.refset.conceptId+"</td><td style='padding: 3px;'>"+b.effectiveTime+"</td><td style='padding: 3px;'>"+b.module+"</td></tr></table>",G=G+'<button type="button" class="btn btn-link unobtrusive-icon more-fields-button pull-right" data-container="body" data-toggle="popover" data-placement="left" data-content="'+c+'" data-html="true"><i class="glyphicon glyphicon-info-sign"></i></button>',G+="</td></tr>"}}),F?(G+="</tbody></table>",A+=G):(G+="<tr><td colspan='2'><span class='i18n text-muted' data-i18n-id='i18n_no_memberships'>No memberships</span></td></tr>",G+="</tbody></table>");var H=!1,I="<table class='table table-bordered'>";I+="<thead><tr>",I+="<th><span class='i18n' data-i18n-id='i18n_association_refset_name'>Association Refset name</span></th>",I+="<th><span class='i18n' data-i18n-id='i18n_value'>Value</span></th>",I+="</tr></thead><tbody>",$.each(c.memberships,function(a,b){if("ASSOCIATION"==b.type){H=!0,I+="<tr class='",b.active||(I+=" danger"),I+="'><td>",I="Primitive"==b.refset.definitionStatus?I+'<a href="javascript:void(0);" style="color: inherit;text-decoration: inherit;"><span class="badge alert-warning jqui-draggable"  data-concept-id="'+b.refset.conceptId+'" data-term="'+b.refset.defaultTerm+'" data-def-status="'+b.refset.definitionStatus+'">&nbsp;</span></a>&nbsp;&nbsp;':I+'<a href="javascript:void(0);" style="color: inherit;text-decoration: inherit;"><span class="badge alert-warning jqui-draggable"  data-concept-id="'+b.refset.conceptId+'" data-term="'+b.refset.defaultTerm+'" data-def-status="'+b.refset.definitionStatus+'">&equiv;</span></a>&nbsp;&nbsp;',I=I+b.refset.defaultTerm+"</td>",I+="<td>",I="Primitive"==b.cidValue.definitionStatus?I+'<a href="javascript:void(0);" style="color: inherit;text-decoration: inherit;"><span class="badge alert-warning jqui-draggable"  data-concept-id="'+b.cidValue.conceptId+'" data-term="'+b.cidValue.defaultTerm+'" data-def-status="'+b.cidValue.definitionStatus+'">&nbsp;</span></a>&nbsp;&nbsp;':I+'<a href="javascript:void(0);" style="color: inherit;text-decoration: inherit;"><span class="badge alert-warning jqui-draggable"  data-concept-id="'+b.cidValue.conceptId+'" data-term="'+b.cidValue.defaultTerm+'" data-def-status="'+b.cidValue.definitionStatus+'">&equiv;</span></a>&nbsp;&nbsp;',I=I+b.cidValue.defaultTerm+"</td>";var c="<table border='1'><tr><th style='padding: 3px;'>RefsetId</th><th style='padding: 3px;'>Effective Time</th><th style='padding: 3px;'>ModuleId</th></tr>";c=c+"<tr><td style='padding: 3px;'>"+b.refset.conceptId+"</td><td style='padding: 3px;'>"+b.effectiveTime+"</td><td style='padding: 3px;'>"+b.module+"</td></tr></table>",I=I+'<button type="button" class="btn btn-link unobtrusive-icon more-fields-button pull-right" data-container="body" data-toggle="popover" data-placement="left" data-content="'+c+'" data-html="true"><i class="glyphicon glyphicon-info-sign"></i></button>',I+="</td></tr>"}}),H?(I+="</tbody></table>",A+=I):(I+="<tr><td colspan='2'><span class='i18n text-muted' data-i18n-id='i18n_no_memberships'>No memberships</span></td></tr>",I+="</tbody></table>")}$("#refsets-"+d.divElement.id).html(A),"diagram-tab"==$("ul#details-tabs-"+d.divElement.id+" li.active").attr("id")&&($("#diagram-canvas-"+d.divElement.id).html(""),drawConceptDiagram(c,$("#diagram-canvas-"+d.divElement.id),d.options)),$("#diagram-tab-link-"+d.divElement.id).click(function(){$("#diagram-canvas-"+d.divElement.id).html("<i class='glyphicon glyphicon-refresh icon-spin'></i>"),setTimeout(function(){$("#diagram-canvas-"+d.divElement.id).html(""),drawConceptDiagram(c,$("#diagram-canvas-"+d.divElement.id),d.options)},1e3)}),$(".more-fields-button").disableTextSelect(),$(".more-fields-button").popover(),"stated"==d.options.selectedView?$("#"+d.relsPId).find(".inferred-rel").each(function(a,b){$(b).toggle()}):"inferred"==d.options.selectedView?$("#"+d.relsPId).find(".stated-rel").each(function(a,b){$(b).toggle()}):"all"!=d.options.selectedView,$("#"+d.relsPId+",#home-parents-"+d.divElement.id+",#home-roles-"+d.divElement.id+",#refsets-"+d.divElement.id).find(".jqui-draggable").draggable({appendTo:"body",helper:"clone",delay:500}),$("#"+d.relsPId+",#home-parents-"+d.divElement.id+",#home-roles-"+d.divElement.id).find(".jqui-draggable").tooltip({placement:"left auto",trigger:"hover",title:i18n_drag_this,animation:!0,delay:500}),"function"==typeof switchLanguage&&switchLanguage(selectedLanguage,selectedFlag,!1),g=0}).fail(function(){$("#"+d.attributesPId).html("<div class='alert alert-danger'><span class='i18n' data-i18n-id='i18n_ajax_failed'><strong>Error</strong> while retrieving data from server...</span></div>"),$("#"+d.descsPId).html(""),$("#"+d.relsPId).html(""),$("#"+d.relsPId).html("")}),0==d.options.displayChildren?($("#"+d.childrenPId).html(""),$("#"+d.childrenPId).hide()):($("#"+d.childrenPId).show(),null!=f&&(f.abort(),console.log("aborting children call...")),f=$.getJSON(c.serverUrl+"/"+c.edition+"/"+c.release+"/concepts/"+d.conceptId+"/children?form=inferred",function(){}).done(function(b){f=null,d.childrenPId=a.id+"-children-panel",childrenDetailsHtml="<div>",childrenDetailsHtml="<table class='table table-bordered'>",childrenDetailsHtml+="<thead><tr>",childrenDetailsHtml+="<th><span class='i18n' data-i18n-id='i18n_children'>Children</span></th>",childrenDetailsHtml+="</tr></thead><tbody></div>",$.each(b,function(a,b){1==b.active&&(childrenDetailsHtml=childrenDetailsHtml+"<tr><td class='jqui-draggable' data-concept-id='"+b.conceptId+"' data-term='"+b.defaultTerm+"'>"+b.defaultTerm+"</td></tr>")}),childrenDetailsHtml+="</tbody></table>",$("#"+d.childrenPId).html(childrenDetailsHtml),$("#"+d.childrenPId).find(".jqui-draggable").draggable({appendTo:"body",helper:"clone",delay:500})}).fail(function(){$("#"+d.childrenPId).html("<div class='alert alert-danger'><span class='i18n' data-i18n-id='i18n_ajax_failed'><strong>Error</strong> while retrieving data from server...</span></div>")})))},this.stripDiagrammingMarkup=function(a){return a=a.replace(new RegExp(d.escapeRegExp("sct-primitive-concept-compact"),"g"),""),a=a.replace(new RegExp(d.escapeRegExp("sct-defined-concept-compact"),"g"),""),a=a.replace(new RegExp(d.escapeRegExp("sct-attribute-compact"),"g"),"")},this.escapeRegExp=function(a){return a.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},this.setSubscription=function(a){d.subscription=a,$("#"+d.divElement.id+"-subscribersMarker").css("color",a.markerColor),$("#"+d.divElement.id+"-subscribersMarker").show()},this.clearSubscription=function(){d.subscription=null,$("#"+d.divElement.id+"-subscribersMarker").hide()},this.setupOptionsPanel=function(){optionsHtml='<form role="form" id="'+d.divElement.id+'-options-form">',optionsHtml+='<div class="form-group">',optionsHtml+='<div class="checkbox">',optionsHtml+="<label>",optionsHtml=0==d.options.displaySynonyms?optionsHtml+'<input type="checkbox" id="'+d.divElement.id+'-displaySynonymsOption"> <span class="i18n" data-i18n-id="i18n_display_synonyms2">Display Synonyms along with FSN and preferred terms</span>':optionsHtml+'<input type="checkbox" id="'+d.divElement.id+'-displaySynonymsOption" checked> <span class="i18n" data-i18n-id="i18n_display_synonyms2">Display Synonyms along with FSN and preferred terms</span>',optionsHtml+="</label>",optionsHtml+="</div>",optionsHtml+='<div class="checkbox">',optionsHtml+="<label>",optionsHtml=0==d.options.showIds?optionsHtml+'<input type="checkbox" id="'+d.divElement.id+'-displayIdsOption"> <span class="i18n" data-i18n-id="i18n_display_ids">Display Ids</span>':optionsHtml+'<input type="checkbox" id="'+d.divElement.id+'-displayIdsOption" checked> <span class="i18n" data-i18n-id="i18n_display_ids">Display Ids</span>',optionsHtml+="</label>",optionsHtml+="</div>",optionsHtml+='<div class="checkbox">',optionsHtml+="<label>",optionsHtml=0==d.options.displayInactiveDescriptions?optionsHtml+'<input type="checkbox" id="'+d.divElement.id+'-displayInactiveDescriptionsOption"> <span class="i18n" data-i18n-id="i18n_display_inactive_descriptions">Display inactive descriptions</span>':optionsHtml+'<input type="checkbox" id="'+d.divElement.id+'-displayInactiveDescriptionsOption" checked> <span class="i18n" data-i18n-id="i18n_display_inactive_descriptions">Display inactive descriptions</span>',optionsHtml+="</label>",optionsHtml+="</div>",optionsHtml+='<div class="checkbox">',optionsHtml+="<label>",optionsHtml=0==d.options.hideNotAcceptable?optionsHtml+'<input type="checkbox" id="'+d.divElement.id+'-hideNotAcceptableOption"> <span class="i18n" data-i18n-id="i18n_hide_not_acceptable">Hide descriptions with no acceptability</span>':optionsHtml+'<input type="checkbox" id="'+d.divElement.id+'-hideNotAcceptableOption" checked> <span class="i18n" data-i18n-id="i18n_hide_not_acceptable">Hide descriptions with no acceptability</span>',optionsHtml+="</label>",optionsHtml+="</div>",optionsHtml+='<div class="checkbox">',optionsHtml+="<label>",optionsHtml=0==d.options.diagrammingMarkupEnabled?optionsHtml+'<input type="checkbox" id="'+d.divElement.id+'-diagrammingMarkupEnabledOption"> <span class="i18n" data-i18n-id="i18n_diagramming_markup_enabled">Diagramming Guideline colors enabled</span>':optionsHtml+'<input type="checkbox" id="'+d.divElement.id+'-diagrammingMarkupEnabledOption" checked> <span class="i18n" data-i18n-id="i18n_diagramming_markup_enabled">Diagramming Guideline colors enabled</span>',optionsHtml+="</label>",optionsHtml+="</div>",optionsHtml+="</div>",optionsHtml+='<div class="form-group">',optionsHtml+='<label for="selectedRelsView"><span class="i18n" data-i18n-id="i18n_rels_view">Relationships View</span></label>',optionsHtml=optionsHtml+'<select class="form-control" id="'+d.divElement.id+'-relsViewOption">',"undefined"==typeof i18n_inferred&&(i18n_inferred="Inferred"),"undefined"==typeof i18n_stated&&(i18n_stated="Stated"),"undefined"==typeof i18n_all&&(i18n_all="All"),optionsHtml="stated"==d.options.selectedView?optionsHtml+'<option value="stated" selected>'+i18n_stated+"</option>":optionsHtml+'<option value="stated">'+i18n_stated+"</option>",optionsHtml="inferred"==d.options.selectedView?optionsHtml+'<option value="inferred" selected>'+i18n_inferred+"</option>":optionsHtml+'<option value="inferred">'+i18n_inferred+"</option>",optionsHtml="all"==d.options.selectedView?optionsHtml+'<option value="all" selected>'+i18n_all+"</option>":optionsHtml+'<option value="all">'+i18n_all+"</option>",optionsHtml+="</select>",optionsHtml+="</div>",optionsHtml+='<div class="form-group">',optionsHtml=optionsHtml+'<label for="'+d.divElement.id+'-langRefsetOption"><span class="i18n" data-i18n-id="i18n_language_refset">Language Refset</span></label>',optionsHtml=optionsHtml+'<select class="form-control" id="'+d.divElement.id+'-langRefsetOption">',optionsHtml+="900000000000508004"==d.options.langRefset?'<option value="900000000000508004" selected>GB Language Refset</option>':'<option value="900000000000508004">GB Language Refset</option>',optionsHtml+="900000000000509007"==d.options.langRefset?'<option value="900000000000509007" selected>US Language Refset</option>':'<option value="900000000000509007">US Language Refset</option>',optionsHtml+="450828004"==d.options.langRefset?'<option value="450828004" selected>ES Language Refset</option>':'<option value="450828004">ES Language Refset</option>',optionsHtml+="554461000005103"==d.options.langRefset?'<option value="554461000005103" selected>DA Language Refset</option>':'<option value="554461000005103">DA Language Refset</option>',optionsHtml+="46011000052107"==d.options.langRefset?'<option value="46011000052107" selected>SV Language Refset</option>':'<option value="46011000052107">SV Language Refset</option>',optionsHtml+="</select>",optionsHtml+="</div>",optionsHtml+="</form>",$("#"+d.divElement.id+"-modal-body").html(optionsHtml)},this.readOptionsPanel=function(){d.options.displaySynonyms=$("#"+d.divElement.id+"-displaySynonymsOption").is(":checked"),d.options.showIds=$("#"+d.divElement.id+"-displayIdsOption").is(":checked"),d.options.displayChildren=$("#"+d.divElement.id+"-childrenOption").is(":checked"),d.options.hideNotAcceptable=$("#"+d.divElement.id+"-hideNotAcceptableOption").is(":checked"),d.options.displayInactiveDescriptions=$("#"+d.divElement.id+"-displayInactiveDescriptionsOption").is(":checked"),d.options.diagrammingMarkupEnabled=$("#"+d.divElement.id+"-diagrammingMarkupEnabledOption").is(":checked"),d.options.selectedView=$("#"+d.divElement.id+"-relsViewOption").val(),d.options.langRefset=$("#"+d.divElement.id+"-langRefsetOption").val()},this.removeSemtag=function(a){return a.lastIndexOf("(")>0?a.substr(0,a.lastIndexOf("(")-1):a}}function updateCD(a,b){$.each(componentsRegistry,function(c,d){d.divElement.id==a&&(d.conceptId=b,d.updateCanvas())}),$(".history-button").popover("hide")}function cancelSubscription(a,b){var c,d;$.each(componentsRegistry,function(e,f){f.divElement.id==a?c=f:f.divElement.id==b&&(d=f)}),c.unsubscribe(d),$(d.divElement).find(".linker-button").popover("toggle")}function getRandomColor(){for(var a="0123456789ABCDEF".split(""),b="#",c=0;6>c;c++)b+=a[Math.round(15*Math.random())];return b}function drawConceptDiagram(a,b,c){var d=[],e=[];"stated"==c.selectedView?$.each(a.statedRelationships,function(a,b){1==b.active&&(116680003==b.type.conceptId?d.push(b):e.push(b))}):$.each(a.relationships,function(a,b){1==b.active&&(116680003==b.type.conceptId?d.push(b):e.push(b))});var f=b;f.svg("destroy"),f.svg({settings:{width:"1000px",height:"2000px"}});var g=f.svg("get");loadDefs(g);var h=10,i=10,j="";j="Primitive"==a.definitionStatus?"sct-primitive-concept":"sct-defined-concept";var k=drawSctBox(g,h,i,a.defaultTerm,a.conceptId,j);h+=90,i=i+k.getBBox().height+40;var l;l="Primitive"==a.definitionStatus?drawSubsumedByNode(g,h,i):drawEquivalentNode(g,h,i),connectElements(g,k,l,"bottom-50","left"),h+=55;var m=drawConjunctionNode(g,h,i);connectElements(g,l,m,"right","left","LineMarker"),h+=40,i-=18,j="sct-defined-concept",$.each(d,function(a,b){j="Primitive"==b.target.definitionStatus?"sct-primitive-concept":"sct-defined-concept";var c=drawSctBox(g,h,i,b.target.defaultTerm,b.target.conceptId,j);connectElements(g,m,c,"center","left","ClearTriangle"),i=i+c.getBBox().height+25});var n=0;$.each(e,function(a,b){if(j="Primitive"==b.target.definitionStatus?"sct-primitive-concept":"sct-defined-concept",0==b.groupId){var c=drawSctBox(g,h,i,b.type.defaultTerm,b.type.conceptId,"sct-attribute");connectElements(g,m,c,"center","left");var d=drawSctBox(g,h+c.getBBox().width+50,i,b.target.defaultTerm,b.target.conceptId,j);connectElements(g,c,d,"right","left"),i=i+d.getBBox().height+25}else b.groupId>n&&(n=b.groupId)}),i+=15;for(var o=1;n>=o;o++){var p=drawAttributeGroupNode(g,h,i);connectElements(g,m,p,"center","left");var q=drawConjunctionNode(g,h+55,i);connectElements(g,p,q,"right","left"),$.each(e,function(a,b){if(b.groupId==o){j="Primitive"==b.target.definitionStatus?"sct-primitive-concept":"sct-defined-concept";var c=drawSctBox(g,h+85,i-18,b.type.defaultTerm,b.type.conceptId,"sct-attribute");connectElements(g,q,c,"center","left");var d=drawSctBox(g,h+85+c.getBBox().width+30,i-18,b.target.defaultTerm,b.target.conceptId,j);connectElements(g,c,d,"right","left"),i=i+d.getBBox().height+25}})}var r='<?xml version="1.0" encoding="UTF-8" standalone="no"?>'+f.html();r=r.substr(0,r.indexOf("svg")+4)+' xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://web.resource.org/cc/" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" '+r.substr(r.indexOf("svg")+5);var s=Base64.encode(r);$(b).prepend($("<a href-lang='image/svg+xml' href='data:image/svg+xml;base64,\n"+s+"' download='diagram.svg'>Download</a>"))}function saveAsPng(a){var b=document.createElement("canvas");b.id="canvas",document.body.appendChild(b),canvg(document.getElementById("canvas"),a),Canvas2Image.saveAsPNG(b),b.width=b.width}function searchPanel(a,b){var c=null,d=this;this.subscribers=[];var e="",f=null;"undefined"==typeof componentsRegistry&&(componentsRegistry=[]),this.markerColor="black",this.type="search",this.divElement=a,this.options=jQuery.extend(!0,{},b);var g=!1;$.each(componentsRegistry,function(a,b){b.divElement.id==d.divElement.id&&(g=!0)}),0==g&&componentsRegistry.push(d),this.history=[],this.setupCanvas=function(){var f={divElementId:d.divElement.id};$.get("views/searchPlugin/main.hbs").then(function(g){var h=Handlebars.compile(g);$(a).html(h(f)),$("#"+d.divElement.id+"-searchBox").keyup(function(){clearTimeout(c);var a=$(this);c=setTimeout(function(){d.search(a.val(),0,100,!1)},500)}),$("#"+d.divElement.id+"-linkerButton").disableTextSelect(),$("#"+d.divElement.id+"-subscribersMarker").disableTextSelect(),$("#"+d.divElement.id+"-configButton").disableTextSelect(),$("#"+d.divElement.id+"-historyButton").disableTextSelect(),$("#"+d.divElement.id+"-collapseButton").disableTextSelect(),$("#"+d.divElement.id+"-expandButton").disableTextSelect(),$("#"+d.divElement.id+"-closeButton").disableTextSelect(),$("#"+d.divElement.id+"-clearButton").disableTextSelect(),$("#"+d.divElement.id+"-expandButton").hide(),$("#"+d.divElement.id+"-subscribersMarker").hide(),$("#"+d.divElement.id).find(".semtag-button").click(function(){console.log("Semtag click: "+$(this).html())}),"fullText"!=b.searchMode&&$("#"+d.divElement.id+"-navLanguageLabel").closest("a").hide(),$("#"+d.divElement.id+"-configButton").click(function(){$("#"+d.divElement.id+"-searchConfigBar").slideToggle("slow")}),"undefined"!=typeof d.options.closeButton&&0==d.options.closeButton&&$("#"+d.divElement.id+"-closeButton").hide(),"undefined"!=typeof d.options.linkerButton&&0==d.options.linkerButton&&$("#"+d.divElement.id+"-linkerButton").hide(),"undefined"!=typeof d.options.subscribersMarker&&0==d.options.subscribersMarker&&$("#"+d.divElement.id+"-subscribersMarker").remove(),"undefined"!=typeof d.options.collapseButton&&0==d.options.collapseButton&&($("#"+d.divElement.id+"-expandButton").hide(),$("#"+d.divElement.id+"-collapseButton").hide()),$("#"+d.divElement.id+"-expandButton").click(function(){$("#"+d.divElement.id+"-panelBody").slideDown("fast"),$("#"+d.divElement.id+"-expandButton").hide(),$("#"+d.divElement.id+"-collapseButton").show()}),$("#"+d.divElement.id+"-collapseButton").click(function(){$("#"+d.divElement.id+"-panelBody").slideUp("fast"),$("#"+d.divElement.id+"-expandButton").show(),$("#"+d.divElement.id+"-collapseButton").hide()}),"undefined"==typeof i18n_panel_options&&(i18n_panel_options="Panel options"),$("#"+d.divElement.id+"-configButton").tooltip({placement:"left",trigger:"hover",title:i18n_panel_options,animation:!0,delay:1e3}),"undefined"==typeof i18n_history&&(i18n_history="History"),$("#"+d.divElement.id+"-historyButton").tooltip({placement:"left",trigger:"hover",title:i18n_history,animation:!0,delay:1e3}),"undefined"==typeof i18n_panel_links&&(i18n_panel_links="Panel links"),$("#"+d.divElement.id+"-linkerButton").tooltip({placement:"left",trigger:"hover",title:i18n_panel_links,animation:!0,delay:1e3}),$("#"+d.divElement.id+"-linkerButton").draggable({cancel:!1,appendTo:"body",helper:"clone",delay:500}),$("#"+d.divElement.id+"-linkerButton").droppable({drop:d.handlePanelDropEvent,hoverClass:"bg-info"}),$("#"+d.divElement.id+"-apply-button").click(function(){d.readOptionsPanel();var a=$("#"+d.divElement.id+"-searchBox").val();console.log("searchTerm: "+a),a.length>0&&d.search(a+" ",0,100,!1)}),$("#"+d.divElement.id+"-clearButton").click(function(){d.options.semTagFilter="none",d.options.langFilter="none",$("#"+d.divElement.id+"-searchBox").val(""),$("#"+d.divElement.id+"-searchFilters").html(""),$("#"+d.divElement.id+"-resultsTable").html(""),$("#"+d.divElement.id+"-searchBar").html(""),$("#"+d.divElement.id+"-typeIcon").removeClass("glyphicon-ok"),$("#"+d.divElement.id+"-typeIcon").removeClass("text-success"),$("#"+d.divElement.id+"-typeIcon").addClass("glyphicon-remove"),$("#"+d.divElement.id+"-typeIcon").addClass("text-danger"),e=""}),$("#"+d.divElement.id+"-historyButton").click(function(){$("#"+d.divElement.id+"-historyButton").popover({trigger:"manual",placement:"bottomRight",html:!0,content:function(){historyHtml='<div style="height:100px;overflow:auto;">',0==d.history.length&&(historyHtml=historyHtml+'<div class="text-center text-muted" style="width:100%"><em>'+i18n_no_search_terms+"</span>...</em></div>"),historyHtml+="<table>";var a=d.history.slice(0);return a.reverse(),$.each(a,function(a,b){var c=new Date,e=c.getTime(),f=e-b.time,g="";6e4>f?g=1==Math.round(f/1e3)?Math.round(f/1e3)+" second ago":Math.round(f/1e3)+" seconds ago":36e5>f?g=1==Math.round(f/1e3/60)?Math.round(f/1e3/60)+" minute ago":Math.round(f/1e3/60)+" minutes ago":216e6>f&&(g=1==Math.round(f/1e3/60/60)?Math.round(f/1e3/60/60)+" hour ago":Math.round(f/1e3/60/60)+" hours ago"),historyHtml=historyHtml+'<tr><td><a href="javascript:void(0);" onclick="searchInPanel(\''+d.divElement.id+"','"+b.searchTerm+"');\">"+b.searchTerm+"</a>",historyHtml=historyHtml+' <span class="text-muted" style="font-size: 80%"><em>'+g+"<em></span>",historyHtml+="</td></tr>"}),historyHtml+="</table>",historyHtml+="</div>"}}),$("#"+d.divElement.id+"-historyButton").popover("toggle")}),$("#"+d.divElement.id+"-linkerButton").click(function(){$("#"+d.divElement.id+"-linkerButton").popover({trigger:"manual",placement:"bottomRight",html:!0,content:function(){var a='<div class="text-center text-muted"><em><span class="i18n" data-i18n-id="i18n_drag_to_link">Drag to link with other panels</span><br>';return a=1==d.subscribers.length?a+d.subscribers.length+" link established</em></div>":a+d.subscribers.length+" links established</em></div>",a=a+'<div class="text-center"><a href="javascript:void(0);" onclick="clearSearchPanelSubscriptions(\''+d.divElement.id+'\');"><span class="i18n" data-i18n-id="i18n_clear_links">Clear links</span></a></div>'}}),$("#"+d.divElement.id+"-linkerButton").popover("toggle")}),$("#"+d.divElement.id+"-fullTextButton").click(function(){d.options.searchMode="fullText",d.updateSearchLabel();var a=$("#"+d.divElement.id+"-searchBox").val();$("#"+d.divElement.id+"-navLanguageLabel").closest("a").show(),"^"==a.charAt(0)&&$("#"+d.divElement.id+"-searchBox").val(a.slice(1)),a.length>0&&d.search(a,0,100,!0)}),$("#"+d.divElement.id+"-partialMatchingButton").click(function(){d.options.searchMode="partialMatching",d.updateSearchLabel();var a=$("#"+d.divElement.id+"-searchBox").val();$("#"+d.divElement.id+"-navLanguageLabel").closest("a").hide(),"^"==a.charAt(0)&&$("#"+d.divElement.id+"-searchBox").val(a.slice(1)),a.length>0&&d.search(a,0,100,!0)}),$("#"+d.divElement.id+"-regexButton").click(function(){d.options.searchMode="regex",d.updateSearchLabel();var a=$("#"+d.divElement.id+"-searchBox").val();$("#"+d.divElement.id+"-navLanguageLabel").closest("a").hide(),"^"!=a.charAt(0)&&$("#"+d.divElement.id+"-searchBox").val("^"+a),a.length>0&&d.search(a,0,100,!0)}),$("#"+d.divElement.id+"-danishLangButton").click(function(){d.options.searchLang="danish",$("#"+d.divElement.id+"-navLanguageLabel").html(i18n_danish_stemmer);var a=$("#"+d.divElement.id+"-searchBox").val();a.length>0&&d.search(a,0,100,!0)}),$("#"+d.divElement.id+"-englishLangButton").click(function(){d.options.searchLang="english",$("#"+d.divElement.id+"-navLanguageLabel").html(i18n_english_stemmer);var a=$("#"+d.divElement.id+"-searchBox").val();a.length>0&&d.search(a,0,100,!0)}),$("#"+d.divElement.id+"-spanishLangButton").click(function(){d.options.searchLang="spanish",$("#"+d.divElement.id+"-navLanguageLabel").html(i18n_spanish_stemmer);var a=$("#"+d.divElement.id+"-searchBox").val();a.length>0&&d.search(a,0,100,!0)}),$("#"+d.divElement.id+"-swedishLangButton").click(function(){d.options.searchLang="swedish",$("#"+d.divElement.id+"-navLanguageLabel").html(i18n_swedish_stemmer);var a=$("#"+d.divElement.id+"-searchBox").val();a.length>0&&d.search(a,0,100,!0)}),d.updateStatusFilterLabel(),$("#"+d.divElement.id+"-activeOnlyButton").click(function(){d.options.statusSearchFilter="activeOnly",d.updateStatusFilterLabel()}),$("#"+d.divElement.id+"-activeInactiveButton").click(function(){d.options.statusSearchFilter="activeAndInactive",d.updateStatusFilterLabel()}),$("#"+d.divElement.id+"-inactiveOnlyButton").click(function(){d.options.statusSearchFilter="inactiveOnly",d.updateStatusFilterLabel()}),$("#"+d.divElement.id+"-partialMatchingButton").click()})},this.updateStatusFilterLabel=function(){"undefined"==typeof i18n_active_and_inactive&&(i18n_active_and_inactive="Active and Inactive"),"undefined"==typeof i18n_inactive_only&&(i18n_inactive_only="Inactive Only"),"undefined"==typeof i18n_active_only&&(i18n_active_only="Active Only"),"activeAndInactive"==d.options.statusSearchFilter?$("#"+d.divElement.id+"-navStatusFilterLabel").html(i18n_active_and_inactive):"inactiveOnly"==d.options.statusSearchFilter?$("#"+d.divElement.id+"-navStatusFilterLabel").html(i18n_inactive_only):(d.options.statusSearchFilter="activeOnly",$("#"+d.divElement.id+"-navStatusFilterLabel").html(i18n_active_only));var a=$("#"+d.divElement.id+"-searchBox").val();a.length>0&&d.search(a,0,100,!0)},this.handlePanelDropEvent=function(a,b){var c=b.draggable;c.attr("data-panel")&&$.each(componentsRegistry,function(a,b){b.divElement.id==c.attr("data-panel")&&"concept-details"==b.type&&d.subscribe(b)})},this.search=function(a,c,g,h){if("undefined"==typeof d.options.searchMode&&(d.options.searchMode="partialMatching"),"undefined"==typeof d.options.semTagFilter&&(d.options.semTagFilter="none"),"undefined"==typeof d.options.langFilter&&(d.options.langFilter="none"),"undefined"==typeof h&&(h=!1),""!=a&&(a!=e||h))if(a.length<3)$("#"+d.divElement.id+"-typeIcon").removeClass("glyphicon-ok"),$("#"+d.divElement.id+"-typeIcon").removeClass("text-success"),$("#"+d.divElement.id+"-typeIcon").addClass("glyphicon-remove"),$("#"+d.divElement.id+"-typeIcon").addClass("text-danger");else{$("#"+d.divElement.id+"-typeIcon").removeClass("glyphicon-remove"),$("#"+d.divElement.id+"-typeIcon").removeClass("text-danger"),$("#"+d.divElement.id+"-typeIcon").addClass("glyphicon-ok"),$("#"+d.divElement.id+"-typeIcon").addClass("text-success"),a!=e&&(d.options.semTagFilter="none",d.options.langFilter="none"),e=a;var i=new Date,j=i.getTime();if(d.history.push({searchTerm:a,time:j}),$("#"+d.divElement.id+"-searchFilters").html(""),0==c?$("#"+d.divElement.id+"-resultsTable").html("<i class='glyphicon glyphicon-refresh icon-spin'></i>"):$("#"+d.divElement.id+"-resultsTable").find(".more-row").html("<td colspan='2' class='text-center'><i class='glyphicon glyphicon-refresh icon-spin'></i>&nbsp;&nbsp;</td>"),resultsHtml="",null!=f&&(f.abort(),console.log("aborting call...")),$("#"+d.divElement.id+"-searchBar").html("<span class='text-muted'>Searching..</span>"),a=a.trim(),isNumber(a))"0"==a.substr(-2,1)?f=$.getJSON(b.serverUrl+"/"+b.edition+"/"+b.release+"/concepts/"+a,function(){}).done(function(a){$.each(a.descriptions,function(b,c){c.active===!1||0==c.conceptActive?("inactiveOnly"==d.options.statusSearchFilter||"activeAndInactive"==d.options.statusSearchFilter)&&(resultsHtml+="<tr class='resultRow selectable-row",resultsHtml+=" danger",resultsHtml=resultsHtml+"'><td class='col-md-7'><div class='jqui-draggable result-item' data-concept-id='"+c.conceptId+"' data-term='"+c.term+"'><a href='javascript:void(0);' style='color: inherit;text-decoration: inherit;'  data-concept-id='"+c.conceptId+"' data-term='"+c.term+"'>"+c.term+"</a></div></td><td class='text-muted small-text col-md-5 result-item'  data-concept-id='"+c.conceptId+"' data-term='"+c.term+"'>"+a.defaultTerm+"</td></tr>"):("activeOnly"==d.options.statusSearchFilter||"activeAndInactive"==d.options.statusSearchFilter)&&(resultsHtml+="<tr class='resultRow selectable-row",resultsHtml=resultsHtml+"'><td class='col-md-7'><div class='jqui-draggable result-item' data-concept-id='"+c.conceptId+"' data-term='"+c.term+"'><a href='javascript:void(0);' style='color: inherit;text-decoration: inherit;'  data-concept-id='"+c.conceptId+"' data-term='"+c.term+"'>"+c.term+"</a></div></td><td class='text-muted small-text col-md-5 result-item'  data-concept-id='"+c.conceptId+"' data-term='"+c.term+"'>"+a.defaultTerm+"</td></tr>")}),$("#"+d.divElement.id+"-resultsTable").html(resultsHtml),$("#"+d.divElement.id+"-searchBar").html("<span class='text-muted'></span>"),$("#"+d.divElement.id+"-resultsTable").find(".jqui-draggable").draggable({appendTo:"body",helper:"clone",delay:500}),$("#"+d.divElement.id+"-resultsTable").find(".result-item").click(function(a){$.each(d.subscribers,function(b,c){c.conceptId=$(a.target).attr("data-concept-id"),c.updateCanvas()})})}):"1"==a.substr(-2,1)?f=$.getJSON(b.serverUrl+"/"+b.edition+"/"+b.release+"/descriptions/"+a,function(){}).done(function(a){$.each(a.matches,function(a,b){resultsHtml+="<tr class='resultRow selectable-row",(0==b.active||0==b.conceptActive)&&(resultsHtml+=" danger"),resultsHtml=resultsHtml+"'><td class='col-md-7'><div class='jqui-draggable result-item' data-concept-id='"+b.conceptId+"' data-term='"+b.term+"'><a href='javascript:void(0);' style='color: inherit;text-decoration: inherit;'  data-concept-id='"+b.conceptId+"' data-term='"+b.term+"'>"+b.term+"</a></div></td><td class='text-muted small-text col-md-5 result-item'  data-concept-id='"+b.conceptId+"' data-term='"+b.term+"'>"+b.fsn+"</td></tr>"}),$("#"+d.divElement.id+"-resultsTable").html(resultsHtml),$("#"+d.divElement.id+"-searchBar").html("<span class='text-muted'></span>"),$("#"+d.divElement.id+"-resultsTable").find(".jqui-draggable").draggable({appendTo:"body",helper:"clone",delay:500}),$("#"+d.divElement.id+"-resultsTable").find(".result-item").click(function(a){$.each(d.subscribers,function(b,c){c.conceptId=$(a.target).attr("data-concept-id"),c.updateCanvas()})})}):(resultsHtml+="<tr><td class='text-muted'>No results</td></tr>",$("#"+d.divElement.id+"-resultsTable").html(resultsHtml),$("#"+d.divElement.id+"-searchBar").html("<span class='text-muted'></span>"));else{"partialMatching"==d.options.searchMode&&(a=a.toLowerCase());var k=Date.now(),l=b.serverUrl+"/"+b.edition+"/"+b.release+"/descriptions?query="+a+"&limit=50&searchMode="+d.options.searchMode+"&lang="+d.options.searchLang+"&statusFilter="+d.options.statusSearchFilter+"&skipTo="+c+"&returnLimit="+g;"none"!=d.options.semTagFilter&&(l=l+"&semanticFilter="+d.options.semTagFilter),"none"!=d.options.langFilter&&(l=l+"&langFilter="+d.options.langFilter),f=$.getJSON(l,function(){}).done(function(b){$("#"+d.divElement.id+"-resultsTable").find(".more-row").remove();var e=Date.now(),h=(e-k)/1e3;if(b.details)var i="<span class='text-muted'>"+b.details.total+" matches found in "+h+" seconds.</span>";$("#"+d.divElement.id+"-searchBar").html(i),f=null;var j=b.matches;if(!j||j.length<=0)resultsHtml+="<tr><td class='text-muted'>No results</td></tr>",$("#"+d.divElement.id+"-resultsTable").html(resultsHtml);else{var l="<span class='pull right'><a class='btm btn-xs' style='margin: 3px; color: #777; background-color: #fff; border: 1px #ccc solid; margin-left: 25px;' data-toggle='collapse' href='#"+d.divElement.id+"-searchFiltersPanel'><span class='i18n' data-i18n-id='i18n_filters'>Filters</span></a>";"none"!=d.options.semTagFilter&&(l=l+"&nbsp;&nbsp;<span class='label label-danger'>"+d.options.semTagFilter+"&nbsp;<a href='javascript:void(0);' style='color: white;text-decoration: none;' class='remove-semtag'>&times;</a></span>&nbsp;&nbsp;"),"none"!=d.options.langFilter&&(l=l+"&nbsp;&nbsp;<span class='label label-danger'>"+d.options.langFilter+"&nbsp;<a href='javascript:void(0);' style='color: white;text-decoration: none;' class='remove-lang'>&times;</a></span>&nbsp;&nbsp;"),l=l+"</span><div id='"+d.divElement.id+"-searchFiltersPanel' class='panel-collapse collapse'>",l+="<div class='tree'><ul><li><a>Filter results by Language</a><ul>";
for(var m in b.filters.lang)l=l+"<li><a class='lang-link' href='javascript:void(0);' data-lang='"+m+"'>"+m+" ("+b.filters.lang[m]+")</a></li>";l+="</ul></li></ul>",l+="<ul><li><a>Filter results by Semantic Tag</a><ul>";for(var m in b.filters.semTag)l=l+"<li><a class='semtag-link' href='javascript:void(0);' data-semtag='"+m+"'>"+m+" ("+b.filters.semTag[m]+")</a></li>";l+="</ul></li></ul></div>",$("#"+d.divElement.id+"-searchBar").html($("#"+d.divElement.id+"-searchBar").html()+l),$("#"+d.divElement.id+"-searchBar").find(".semtag-link").click(function(b){d.options.semTagFilter=$(b.target).attr("data-semtag"),d.search(a,0,g,!0)}),$("#"+d.divElement.id+"-searchBar").find(".lang-link").click(function(b){d.options.langFilter=$(b.target).attr("data-lang"),d.search(a,0,g,!0)}),$("#"+d.divElement.id+"-searchBar").find(".remove-semtag").click(function(){d.options.semTagFilter="none",d.search(a,0,g,!0)}),$("#"+d.divElement.id+"-searchBar").find(".remove-lang").click(function(){d.options.langFilter="none",d.search(a,0,g,!0)}),"regex"==d.options.searchMode&&j.sort(function(a,b){return a.term.length<b.term.length?-1:a.term.length>b.term.length?1:0}),$.each(j,function(a,b){resultsHtml+="<tr class='resultRow selectable-row",(0==b.active||0==b.conceptActive)&&(resultsHtml+=" danger"),resultsHtml=resultsHtml+"'><td class='col-md-6'><div class='jqui-draggable result-item' data-concept-id='"+b.conceptId+"' data-term='"+b.term+"'><a href='javascript:void(0);' style='color: inherit;text-decoration: inherit;'  data-concept-id='"+b.conceptId+"' data-term='"+b.term+"'>"+b.term+"</a></div></td><td class='text-muted small-text col-md-6 result-item'  data-concept-id='"+b.conceptId+"' data-term='"+b.term+"'>"+b.fsn+"</td></tr>"});var n=b.details.total-(c+g);resultsHtml=n>0?resultsHtml+"<tr class='more-row'><td colspan='2' class='text-center'><button class='btn btn-link' id='"+d.divElement.id+"-more'>Load "+g+" more ("+n+" remaining on server)</button></td></tr>":resultsHtml+"<tr class='more-row'><td colspan='2' class='text-center text-muted'>All "+b.details.total+" results are displayed</td></tr>",0==c?$("#"+d.divElement.id+"-resultsTable").html(resultsHtml):$("#"+d.divElement.id+"-resultsTable").append(resultsHtml),$("#"+d.divElement.id+"-more").click(function(){d.search(a,parseInt(c)+parseInt(g),g,!0)}),$("#"+d.divElement.id+"-resultsTable").find(".jqui-draggable").draggable({appendTo:"body",helper:"clone",delay:500}),$("#"+d.divElement.id+"-resultsTable").find(".result-item").click(function(a){$.each(d.subscribers,function(b,c){c.conceptId=$(a.target).attr("data-concept-id"),c.updateCanvas(),lastClickedSctid=$(a.target).attr("data-concept-id"),lastClickTime=Date.now()})})}}).fail(function(){resultsHtml+="<tr><td class='text-muted'>No results</td></tr>",$("#"+d.divElement.id+"-resultsTable").html(resultsHtml)})}}},this.subscribe=function(a){var b=!1;$.each(d.subscribers,function(c,d){a.divElement.id==d.divElement.id&&(b=!0)}),b||(0==d.subscribers.length&&("undefined"==typeof globalMarkerColor&&(globalMarkerColor="black"),d.markerColor=d.getNextMarkerColor(globalMarkerColor),$("#"+d.divElement.id+"-subscribersMarker").css("color",d.markerColor),$("#"+d.divElement.id+"-subscribersMarker").show()),d.subscribers.push(a),a.setSubscription(d))},this.unsubscribe=function(a){var b=-1;$.each(d.subscribers,function(c,d){a.divElement.id==d.divElement.id&&(b=c),c+=1}),b>-1&&d.subscribers.splice(b,1),0==d.subscribers.length&&$("#"+d.divElement.id+"-subscribersMarker").hide(),a.clearSubscription()},this.unsubscribeAll=function(){var a=d.subscribers.slice(0);$.each(a,function(a,b){d.unsubscribe(b)})},this.getNextMarkerColor=function(a){var b="black";return"black"==a?b="green":"green"==a?b="purple":"purple"==a?b="red":"red"==a?b="blue":"blue"==a&&(b="green"),globalMarkerColor=b,b},this.updateSearchLabel=function(){"undefined"==typeof d.options.searchMode&&(d.options.searchMode="partialMatching"),"undefined"==typeof i18n_search_examp_1&&(i18n_search_examp_1="Example 1"),"undefined"==typeof i18n_search_examp_2&&(i18n_search_examp_2="Example 2"),"undefined"==typeof i18n_search_examp_3&&(i18n_search_examp_3="Example 3"),"undefined"==typeof i18n_regex_search_mode&&(i18n_regex_search_mode="Regex"),"undefined"==typeof i18n_partial_match_search_mode&&(i18n_partial_match_search_mode="Partial"),"undefined"==typeof i18n_full_text_search_mode&&(i18n_full_text_search_mode="Full"),"regex"==d.options.searchMode?($("#"+d.divElement.id+"-searchExample").html("<span class='i18n text-muted' data-i18n-id='i18n_search_examp_1'>"+i18n_search_examp_1+"</span> "),$("#"+d.divElement.id+"-navSearchModeLabel").html("<span class='i18n' data-i18n-id='i18n_regex_search_mode'>"+i18n_regex_search_mode+"</span>")):"fullText"==d.options.searchMode?($("#"+d.divElement.id+"-searchExample").html("<span class='i18n text-muted' data-i18n-id='i18n_search_examp_2'>"+i18n_search_examp_2+"</em></span> "),$("#"+d.divElement.id+"-navSearchModeLabel").html("<span class='i18n' data-i18n-id='i18n_full_text_search_mode'>"+i18n_full_text_search_mode+"</span>")):"partialMatching"==d.options.searchMode&&($("#"+d.divElement.id+"-searchExample").html("<span class='i18n text-muted' data-i18n-id='i18n_search_examp_3'>"+i18n_search_examp_3+"</span> "),$("#"+d.divElement.id+"-navSearchModeLabel").html("<span class='i18n' data-i18n-id='i18n_partial_match_search_mode'>"+i18n_partial_match_search_mode+"</span>")),"undefined"==typeof d.options.searchLang&&(d.options.searchLang="english"),"undefined"==typeof i18n_danish_stemmer&&(i18n_danish_stemmer="Danish Stemmer"),"undefined"==typeof i18n_english_stemmer&&(i18n_english_stemmer="English Stemmer"),"undefined"==typeof i18n_spanish_stemmer&&(i18n_spanish_stemmer="Spanish Stemmer"),"danish"==d.options.searchLang?$("#"+d.divElement.id+"-navLanguageLabel").html("<span class='i18n' data-i18n-id='i18n_danish_stemmer'>"+i18n_danish_stemmer+"</span>"):"english"==d.options.searchLang?$("#"+d.divElement.id+"-navLanguageLabel").html("<span class='i18n' data-i18n-id='i18n_english_stemmer'>"+i18n_english_stemmer+"</span>"):"spanish"==d.options.searchLang&&$("#"+d.divElement.id+"-navLanguageLabel").html("<span class='i18n' data-i18n-id='i18n_spanish_stemmer'>"+i18n_spanish_stemmer+"</span>")},this.setupCanvas(),this.updateSearchLabel()}function isNumber(a){return!isNaN(parseFloat(a))&&isFinite(a)}function clearSearchPanelSubscriptions(a){var b;$.each(componentsRegistry,function(c,d){d.divElement.id==a&&(b=d)}),b.unsubscribeAll(),$("#"+a).find(".linker-button").popover("toggle")}function searchInPanel(a,b){$.each(componentsRegistry,function(c,d){d.divElement.id==a&&($("#"+a+"-searchBox").val(b),d.search(b,0,100,!1))}),$(".history-button").popover("hide")}function drawSctBox(a,b,c,d,e,f){var g="Test";d&&e?g=d.length>e.toString().length?d:e.toString():d?g=d:e&&(g=e.toString());var h=a.text(b,c,g,{fontFamily:'"Helvetica Neue",Helvetica,Arial,sans-serif',fontSize:"12",fill:"black"}),i=h.getBBox().height,j=h.getBBox().width;a.remove(h);var k=null,l=20,m=25;if(e&&d||(m=15),"sct-primitive-concept"==f)k=a.rect(b,c,j+l,i+m,{id:"rect"+idSequence,fill:"#99ccff",stroke:"#333",strokeWidth:2});else if("sct-defined-concept"==f){k=a.rect(b-2,c-2,j+l+4,i+m+4,{fill:"white",stroke:"#333",strokeWidth:1});{a.rect(b,c,j+l,i+m,{id:"rect"+idSequence,fill:"#ccccff",stroke:"#333",strokeWidth:1})}}else if("sct-attribute"==f){k=a.rect(b-2,c-2,j+l+4,i+m+4,18,18,{fill:"white",stroke:"#333",strokeWidth:1});{a.rect(b,c,j+l,i+m,18,18,{id:"rect"+idSequence,fill:"#ffffcc",stroke:"#333",strokeWidth:1})}}else k="sct-slot"==f?a.rect(b,c,j+l,i+m,{id:"rect"+idSequence,fill:"#99ccff",stroke:"#333",strokeWidth:2}):a.rect(b,c,j+l,i+m,{id:"rect"+idSequence,fill:"white",stroke:"black",strokeWidth:1});return e&&d?(a.text(b+10,c+16,e.toString(),{fontFamily:'"Helvetica Neue",Helvetica,Arial,sans-serif',fontSize:"10",fill:"black"}),a.text(b+10,c+31,d,{fontFamily:'"Helvetica Neue",Helvetica,Arial,sans-serif',fontSize:"12",fill:"black"})):d?a.text(b+10,c+18,d,{fontFamily:'"Helvetica Neue",Helvetica,Arial,sans-serif',fontSize:"12",fill:"black"}):e&&a.text(b+10,c+18,e.toString(),{fontFamily:'"Helvetica Neue",Helvetica,Arial,sans-serif',fontSize:"12",fill:"black"}),idSequence++,$("rect").click(function(a){console.log(a.target)}),k}function connectElements(a,b,c,d,e,f){var g=b.getBBox().x,h=b.getBBox().y,i=b.getBBox().width,j=b.getBBox().height,k=c.getBBox().x,l=c.getBBox().y,m=c.getBBox().width,n=c.getBBox().height,o=15,p=15;switch(d){case"top":originY=h,originX=g+i/2;break;case"bottom":originY=h+j,originX=g+i/2;break;case"left":originX=g-o,originY=h+j/2;break;case"right":originX=g+i,originY=h+j/2;break;case"bottom-50":originY=h+j,originX=g+40;break;default:originX=g+i/2,originY=h+j/2}switch(e){case"top":destinationY=l,destinationX=k+m/2;break;case"bottom":destinationY=l+n,destinationX=k+m/2;break;case"left":destinationX=k-p,destinationY=l+n/2;break;case"right":destinationX=k+m,destinationY=l+n/2;break;case"bottom-50":destinationY=l+n,destinationX=k+50;break;default:destinationX=k+m/2,destinationY=l+n/2}null==f&&(f="BlackTriangle"),polyline1=a.polyline([[originX,originY],[originX,destinationY],[destinationX,destinationY]],{id:"poly1",fill:"none",stroke:"black",strokeWidth:2,"marker-end":"url(#"+f+")"})}function loadDefs(a){var b=a.defs("SctDiagramsDefs");blackTriangle=a.marker(b,"BlackTriangle",0,0,20,20,{viewBox:"0 0 22 20",refX:"0",refY:"10",markerUnits:"strokeWidth",markerWidth:"8",markerHeight:"6",fill:"black",stroke:"black",strokeWidth:2}),a.path(blackTriangle,"M 0 0 L 20 10 L 0 20 z"),clearTriangle=a.marker(b,"ClearTriangle",0,0,20,20,{viewBox:"0 0 22 20",refX:"0",refY:"10",markerUnits:"strokeWidth",markerWidth:"8",markerHeight:"8",fill:"white",stroke:"black",strokeWidth:2}),a.path(clearTriangle,"M 0 0 L 20 10 L 0 20 z"),lineMarker=a.marker(b,"LineMarker",0,0,20,20,{viewBox:"0 0 22 20",refX:"0",refY:"10",markerUnits:"strokeWidth",markerWidth:"8",markerHeight:"8",fill:"white",stroke:"black",strokeWidth:2}),a.path(lineMarker,"M 0 10 L 20 10")}function drawAttributeGroupNode(a,b,c){return circle=a.circle(b,c,20,{fill:"white",stroke:"black",strokeWidth:2})}function drawConjunctionNode(a,b,c){return circle=a.circle(b,c,10,{fill:"black",stroke:"black",strokeWidth:2})}function drawEquivalentNode(a,b,c){return g=a.group(),a.circle(g,b,c,20,{fill:"white",stroke:"black",strokeWidth:2}),a.line(g,b-7,c-5,b+7,c-5,{stroke:"black",strokeWidth:2}),a.line(g,b-7,c,b+7,c,{stroke:"black",strokeWidth:2}),a.line(g,b-7,c+5,b+7,c+5,{stroke:"black",strokeWidth:2}),g}function drawSubsumedByNode(a,b,c){return g=a.group(),a.circle(g,b,c,20,{fill:"white",stroke:"black",strokeWidth:2}),a.line(g,b-7,c-8,b+7,c-8,{stroke:"black",strokeWidth:2}),a.line(g,b-7,c+3,b+7,c+3,{stroke:"black",strokeWidth:2}),a.line(g,b-6,c-8,b-6,c+3,{stroke:"black",strokeWidth:2}),a.line(g,b-7,c+7,b+7,c+7,{stroke:"black",strokeWidth:2}),g}function drawSubsumesNode(a,b,c){return g=a.group(),a.circle(g,b,c,20,{fill:"white",stroke:"black",strokeWidth:2}),a.line(g,b-7,c-8,b+7,c-8,{stroke:"black",strokeWidth:2}),a.line(g,b-7,c+3,b+7,c+3,{stroke:"black",strokeWidth:2}),a.line(g,b+6,c-8,b+6,c+3,{stroke:"black",strokeWidth:2}),a.line(g,b-7,c+7,b+7,c+7,{stroke:"black",strokeWidth:2}),g}function taxonomyPanel(a,b,c){var d=this;this.subscribers=[];var e=null;"undefined"==typeof componentsRegistry&&(componentsRegistry=[]),this.markerColor="black",this.type="taxonomy",this.divElement=a,this.options=jQuery.extend(!0,{},c);var f=!1;$.each(componentsRegistry,function(a,b){b.divElement.id==d.divElement.id&&(f=!0)}),0==f&&componentsRegistry.push(d),this.history=[],this.setupCanvas=function(){var b={divElementId:d.divElement.id};$.get("views/taxonomyPlugin/main.hbs").then(function(c){var e=Handlebars.compile(c);$(a).html(e(b)),$("#"+d.divElement.id+"-resetButton").disableTextSelect(),$("#"+d.divElement.id+"-linkerButton").disableTextSelect(),$("#"+d.divElement.id+"-subscribersMarker").disableTextSelect(),$("#"+d.divElement.id+"-configButton").disableTextSelect(),$("#"+d.divElement.id+"-collapseButton").disableTextSelect(),$("#"+d.divElement.id+"-expandButton").disableTextSelect(),$("#"+d.divElement.id+"-closeButton").disableTextSelect(),$("#"+d.divElement.id+"-expandButton").hide(),$("#"+d.divElement.id+"-subscribersMarker").hide(),$("#"+d.divElement.id+"-closeButton").click(function(){$(a).remove()}),$("#"+d.divElement.id+"-configButton").click(function(){$("#"+d.divElement.id+"-taxonomyConfigBar").slideToggle("slow")}),"undefined"!=typeof d.options.closeButton&&0==d.options.closeButton&&$("#"+d.divElement.id+"-closeButton").hide(),"undefined"!=typeof d.options.linkerButton&&0==d.options.linkerButton&&$("#"+d.divElement.id+"-linkerButton").hide(),"undefined"!=typeof d.options.subscribersMarker&&0==d.options.subscribersMarker&&$("#"+d.divElement.id+"-subscribersMarker").remove(),"undefined"!=typeof d.options.collapseButton&&0==d.options.collapseButton&&($("#"+d.divElement.id+"-expandButton").hide(),$("#"+d.divElement.id+"-collapseButton").hide()),$("#"+d.divElement.id+"-expandButton").click(function(){$("#"+d.divElement.id+"-panelBody").slideDown("fast"),$("#"+d.divElement.id+"-expandButton").hide(),$("#"+d.divElement.id+"-collapseButton").show()}),$("#"+d.divElement.id+"-collapseButton").click(function(){$("#"+d.divElement.id+"-panelBody").slideUp("fast"),$("#"+d.divElement.id+"-expandButton").show(),$("#"+d.divElement.id+"-collapseButton").hide()}),"undefined"==typeof i18n_panel_options&&(i18n_panel_options="Options"),$("#"+d.divElement.id+"-configButton").tooltip({placement:"left",trigger:"hover",title:i18n_panel_options,animation:!0,delay:1e3}),"undefined"==typeof i18n_reset&&(i18n_reset="Reset"),$("#"+d.divElement.id+"-resetButton").tooltip({placement:"left",trigger:"hover",title:i18n_reset,animation:!0,delay:1e3}),"undefined"==typeof i18n_panel_links&&(i18n_panel_links="Panel links"),$("#"+d.divElement.id+"-linkerButton").tooltip({placement:"left",trigger:"hover",title:i18n_panel_links,animation:!0,delay:1e3}),$("#"+d.divElement.id+"-linkerButton").draggable({cancel:!1,appendTo:"body",helper:"clone",delay:500,revert:!1}),$("#"+d.divElement.id+"-panelBody").droppable({drop:d.handleDropEvent,hoverClass:"bg-info"}),$("#"+d.divElement.id+"-panelHeading").droppable({drop:d.handleDropEvent,hoverClass:"bg-info"}),$("#"+d.divElement.id+"-resetButton").click(function(){d.setupParents([],{conceptId:138875005,defaultTerm:"SNOMED CT Concept",definitionStatus:"Primitive"})}),$("#"+d.divElement.id+"-apply-button").click(function(){d.readOptionsPanel(),d.setupParents([],{conceptId:138875005,defaultTerm:"SNOMED CT Concept",definitionStatus:"Primitive"})}),$("#"+d.divElement.id+"-linkerButton").click(function(){$("#"+d.divElement.id+"-linkerButton").popover({trigger:"manual",placement:"bottomRight",html:!0,content:function(){return linkerHtml='<div class="text-center text-muted"><em>Drag to link with other panels<br>',linkerHtml=1==d.subscribers.length?linkerHtml+d.subscribers.length+" link established</em></div>":linkerHtml+d.subscribers.length+" links established</em></div>",linkerHtml=linkerHtml+'<div class="text-center"><a href="javascript:void(0);" onclick="clearTaxonomyPanelSubscriptions(\''+d.divElement.id+"');\">Clear links</a></div>"}}),$("#"+d.divElement.id+"-linkerButton").popover("toggle")}),$("#"+d.divElement.id+"-inferredViewButton").click(function(){d.options.selectedView="inferred",$("#"+d.divElement.id+"-txViewLabel").html("<span class='i18n' data-i18n-id='i18n_inferred_view'>Inferred view</span>"),d.setupParents([],{conceptId:138875005,defaultTerm:"SNOMED CT Concept",definitionStatus:"Primitive"})}),$("#"+d.divElement.id+"-statedViewButton").click(function(){d.options.selectedView="stated",$("#"+d.divElement.id+"-txViewLabel").html("<span class='i18n' data-i18n-id='i18n_stated_view'>Stated view</span>"),d.setupParents([],{conceptId:138875005,defaultTerm:"SNOMED CT Concept",definitionStatus:"Primitive"})}),$("#"+d.divElement.id+"-inferredViewButton").click()})},this.setupParents=function(a,b){var e="<div style='height:100%;margin-bottom: 15px;'>";e+="<ul style='list-style-type: none; padding-left: 5px;'>";var f;$.each(a,function(a,b){f=b,e=e+"<li data-concept-id='"+b.conceptId+"' data-term='"+b.defaultTerm+"' class='treeLabel'>",e=e+"<button class='btn btn-link btn-xs treeButton' style='padding:2px'><i class='glyphicon glyphicon-chevron-up treeButton'  id='"+d.divElement.id+"-treeicon-"+b.conceptId+"'></i></button>",e+="Primitive"==b.definitionStatus?'<span class="badge alert-warning">&nbsp;</span>&nbsp;&nbsp;':'<span class="badge alert-warning">&equiv;</span>&nbsp;&nbsp;',e=e+'<a href="javascript:void(0);" style="color: inherit;text-decoration: inherit;"><span data-concept-id="'+b.conceptId+'" data-term="'+b.defaultTerm+'" class="jqui-draggable treeLabel selectable-row" id="'+d.divElement.id+"-treenode-"+b.conceptId+'">'+b.defaultTerm+"</span></a>",e+="</li>"}),a.length>0&&(e=e.slice(0,-5)),e+="<ul style='list-style-type: none; padding-left: 15px;'>",e=e+"<li data-concept-id='"+b.conceptId+"' data-term='"+b.defaultTerm+"' class='treeLabel'>",e=e+"<button class='btn btn-link btn-xs treeButton' style='padding:2px'><i class='glyphicon glyphicon-chevron-right treeButton'  id='"+d.divElement.id+"-treeicon-"+b.conceptId+"'></i></button>",e+="Primitive"==b.definitionStatus?'<span class="badge alert-warning">&nbsp;</span>&nbsp;&nbsp;':'<span class="badge alert-warning">&equiv;</span>&nbsp;&nbsp;',e=e+'<a href="javascript:void(0);" style="color: inherit;text-decoration: inherit;"><span data-concept-id="'+b.conceptId+'" data-term="'+b.defaultTerm+'" class="jqui-draggable treeLabel selectable-row" id="'+d.divElement.id+"-treenode-"+b.conceptId+'">'+b.defaultTerm+"</span></a>",e+="</li>",e+="</ul>",a.length>0&&(e+="</li>"),e+="</ul>",e+="</div>",$("#"+d.divElement.id+"-panelBody").html(e),$(".treeButton").disableTextSelect(),$(".jqui-draggable").draggable({appendTo:"body",helper:"clone",delay:500}),$("#"+d.divElement.id+"-panelBody").unbind("dblclick"),$("#"+d.divElement.id+"-panelBody").dblclick(function(a){if($(a.target).hasClass("treeLabel")){var b=$(a.target).attr("data-concept-id"),e=$(a.target).attr("data-term");"undefined"!=typeof b&&(console.log(d.options.selectedView),$.getJSON(c.serverUrl+"/"+c.edition+"/"+c.release+"/concepts/"+b+"/parents?form="+d.options.selectedView,function(){}).done(function(a){d.setupParents(a,{conceptId:b,defaultTerm:e,definitionStatus:"Primitive"})}).fail(function(){}))}}),$("#"+d.divElement.id+"-panelBody").unbind("click"),$("#"+d.divElement.id+"-panelBody").click(function(a){if($(a.target).hasClass("treeButton")){var b=$(a.target).closest("li").attr("data-concept-id"),c=d.divElement.id+"-treeicon-"+b;a.preventDefault(),$("#"+c).hasClass("glyphicon-chevron-down")?($(a.target).closest("li").find("ul").remove(),$("#"+c).removeClass("glyphicon-chevron-down"),$("#"+c).addClass("glyphicon-chevron-right")):$("#"+c).hasClass("glyphicon-chevron-right")?($("#"+c).removeClass("glyphicon-chevron-right"),$("#"+c).addClass("glyphicon-refresh"),$("#"+c).addClass("icon-spin"),d.getChildren($(a.target).closest("li").attr("data-concept-id"))):$("#"+c).hasClass("glyphicon-chevron-up")?($("#"+c).removeClass("glyphicon-chevron-up"),$("#"+c).addClass("glyphicon-refresh"),$("#"+c).addClass("icon-spin"),d.wrapInParents($(a.target).closest("li").attr("data-concept-id"),$(a.target).closest("li"))):$("#"+c).hasClass("glyphicon-minus")&&($("#"+c).removeClass("glyphicon-minus"),$("#"+c).addClass("glyphicon-chevron-right"))}else if($(a.target).hasClass("treeLabel")){var e=$(a.target).attr("data-concept-id");"undefined"!=typeof e&&$.each(d.subscribers,function(a,b){b.conceptId!=e&&(b.conceptId=e,b.updateCanvas())})}});var g=d.divElement.id+"-treeicon-"+b.conceptId;$("#"+g).removeClass("glyphicon-chevron-right"),$("#"+g).addClass("glyphicon-refresh"),$("#"+g).addClass("icon-spin"),d.getChildren(b.conceptId)},this.getChildren=function(a){"undefined"==typeof d.options.selectedView&&(d.options.selectedView="inferred"),$("#"+d.divElement.id+"-txViewLabel").html("inferred"==d.options.selectedView?"<span class='i18n' data-i18n-id='i18n_inferred_view'>Inferred view</span>":"<span class='i18n' data-i18n-id='i18n_stated_view'>Stated view</span>"),$.getJSON(c.serverUrl+"/"+c.edition+"/"+c.release+"/concepts/"+a+"/children?form="+d.options.selectedView,function(){}).done(function(b){var c="<ul style='list-style-type: none; padding-left: 15px;'>";b.sort(function(a,b){return a.defaultTerm.toLowerCase()<b.defaultTerm.toLowerCase()?-1:a.defaultTerm.toLowerCase()>b.defaultTerm.toLowerCase()?1:0});var e=[];$.each(b,function(a,b){1==b.active&&(c=c+"<li data-concept-id='"+b.conceptId+"' data-term='"+b.defaultTerm+"' class='treeLabel'>",c=c+"<button class='btn btn-link btn-xs treeButton' style='padding:2px'><i class='glyphicon glyphicon-chevron-right treeButton' id='"+d.divElement.id+"-treeicon-"+b.conceptId+"'></i></button>",c+="Primitive"==b.definitionStatus?'<span class="badge alert-warning">&nbsp;</span>&nbsp;&nbsp;':'<span class="badge alert-warning">&equiv;</span>&nbsp;&nbsp;',c=c+'<a href="javascript:void(0);" style="color: inherit;text-decoration: inherit;"><span class="jqui-draggable treeLabel selectable-row" data-concept-id="'+b.conceptId+'" data-term="'+b.defaultTerm+'" id="'+d.divElement.id+"-treenode-"+b.conceptId+'">'+b.defaultTerm+"</span></a>",e.push(b.conceptId))}),c+="</li>",c+="</ul>",$("#"+d.divElement.id+"-treeicon-"+a).removeClass("glyphicon-refresh"),$("#"+d.divElement.id+"-treeicon-"+a).removeClass("icon-spin"),$("#"+d.divElement.id+"-treeicon-"+a).addClass(b.length>0?"glyphicon-chevron-down":"glyphicon-minus"),$("#"+d.divElement.id+"-treenode-"+a).after(c),$(".treeButton").disableTextSelect(),$.each(e,function(a,b){$("#"+d.divElement.id+"-treenode-"+b).draggable({appendTo:"body",helper:"clone",delay:500,revert:!1})})}).fail(function(){$("#"+d.divElement.id+"-treeicon-"+a).addClass("glyphicon-minus")})},this.wrapInParents=function(a){var b=$("#"+d.divElement.id+"-panelBody").find("ul:first");$.getJSON(c.serverUrl+"/"+c.edition+"/"+c.release+"/concepts/"+a+"/parents?form="+d.options.selectedView,function(){}).done(function(c){if(c.length>0){var e="empty",f=[];$.each(c,function(a,b){var c="<li data-concept-id='"+b.conceptId+"' data-term='"+b.defaultTerm+"' class='treeLabel'>";c=c+"<button class='btn btn-link btn-xs treeButton' style='padding:2px'><i class='glyphicon glyphicon-chevron-up treeButton'  id='"+d.divElement.id+"-treeicon-"+b.conceptId+"'></i></button>",c+="Primitive"==b.definitionStatus?'<span class="badge alert-warning">&nbsp;</span>&nbsp;&nbsp;':'<span class="badge alert-warning">&equiv;</span>&nbsp;&nbsp;',c=c+'<a href="javascript:void(0);" style="color: inherit;text-decoration: inherit;"><span data-concept-id="'+b.conceptId+'" data-term="'+b.defaultTerm+'" class="jqui-draggable treeLabel selectable-row" id="'+d.divElement.id+"-treenode-"+b.conceptId+'">'+b.defaultTerm+"</span></a>",c+="</li>",f.push(c),"empty"==e&&(e=b.conceptId)});var g=b.children().slice(0);b.append(f[0]),$("#"+d.divElement.id+"-treenode-"+e).closest("li").append("<ul id='parent-ul-id-"+e+"' style='list-style-type: none; padding-left: 15px;'></ul>");var h;$.each(g,function(b,c){if($(c).attr("data-concept-id")==a){h=$(c);var f=$("#"+d.divElement.id+"-treenode-"+e).closest("li").find("ul:first");f.append($(c)),$(c).find("i:first").removeClass("glyphicon-chevron-up"),$(c).find("i:first").addClass("glyphicon-chevron-down")}}),$.each(g,function(b,c){$(c).attr("data-concept-id")!=a&&($.each($(c).children(),function(a,b){$(b).is("ul")&&h.append(b)}),$("#"+d.divElement.id+"-treenode-"+$(c).attr("data-concept-id")).closest("li").remove())}),$.each(f,function(a,c){c!=f[0]&&b.prepend(c)}),$("#"+d.divElement.id+"-treeicon-"+a).removeClass("glyphicon-refresh"),$("#"+d.divElement.id+"-treeicon-"+a).removeClass("icon-spin"),$("#"+d.divElement.id+"-treeicon-"+a).addClass("glyphicon-chevron-down")}else $("#"+d.divElement.id+"-treeicon-"+a).removeClass("glyphicon-refresh"),$("#"+d.divElement.id+"-treeicon-"+a).removeClass("icon-spin"),$("#"+d.divElement.id+"-treeicon-"+a).addClass("glyphicon-chevron-up")}).fail(function(){})},this.setToConcept=function(a,b,e){$("#"+d.divElement.id+"-panelBody").html("<i class='glyphicon glyphicon-refresh icon-spin'></i>"),console.log(d.options.selectedView),$.getJSON(c.serverUrl+"/"+c.edition+"/"+c.release+"/concepts/"+a+"/parents?form="+d.options.selectedView,function(){}).done(function(c){"Primitive"!=e&&"Fully defined"!=e&&(e="Primitive"),d.setupParents(c,{conceptId:a,defaultTerm:b,definitionStatus:e})}).fail(function(){})},this.handleDropEvent=function(a,b){var c=b.draggable;if(c.attr("data-concept-id")){var e=c.attr("data-concept-id"),f=c.attr("data-term"),g=c.attr("data-def-status");"undefined"==d.options.selectedView&&(d.options.selectedView="inferred"),"undefined"!=typeof e&&d.setToConcept(e,f,g),$(b.helper).remove()}else;c.attr("data-panel")&&$.each(componentsRegistry,function(a,b){b.divElement.id==c.attr("data-panel")&&"concept-details"==b.type&&d.subscribe(b)})},this.subscribe=function(a){var b=!1;$.each(d.subscribers,function(c,d){a.divElement.id==d.divElement.id&&(b=!0)}),b||(0==d.subscribers.length&&("undefined"==typeof globalMarkerColor&&(globalMarkerColor="black"),d.markerColor=d.getNextMarkerColor(globalMarkerColor),$("#"+d.divElement.id+"-subscribersMarker").css("color",d.markerColor),$("#"+d.divElement.id+"-subscribersMarker").show()),d.subscribers.push(a),a.setSubscription(d))},this.unsubscribe=function(a){var b=-1;$.each(d.subscribers,function(c,d){a.divElement.id==d.divElement.id&&(b=c),c+=1}),b>-1&&d.subscribers.splice(b,1),0==d.subscribers.length&&$("#"+d.divElement.id+"-subscribersMarker").hide(),a.clearSubscription()},this.unsubscribeAll=function(){var a=d.subscribers.slice(0);$.each(a,function(a,b){d.unsubscribe(b)})},this.getNextMarkerColor=function(a){var b="black";return"black"==a?b="green":"green"==a?b="purple":"purple"==a?b="red":"red"==a?b="blue":"blue"==a&&(b="green"),globalMarkerColor=b,b},this.setupCanvas(),b&&138875005!=b?(null!=e&&(e.abort(),console.log("aborting call...")),e=$.getJSON(c.serverUrl+"/"+c.edition+"/"+c.release+"/concepts/"+b,function(){}).done(function(a){d.setToConcept(b,a.defaultTerm)}).fail(function(){console.log("Error")})):this.setupParents([],{conceptId:138875005,defaultTerm:"SNOMED CT Concept",definitionStatus:"Primitive"})}function clearTaxonomyPanelSubscriptions(a){var b;$.each(componentsRegistry,function(c,d){d.divElement.id==a&&(b=d)}),b.unsubscribeAll(),$("#"+a).find(".linker-button").popover("toggle")}$(function(){$.extend($.fn.disableTextSelect=function(){return this.each(function(){$(this).mousedown(function(){return!1})})}),$(".noSelect").disableTextSelect()}),function(a){a.fn.addConceptDetails=function(a,b){this.filter("div").each(function(){var c=new conceptDetails(this,a,b);c.setupCanvas()})}}(jQuery),$(document).keypress(function(a){"13"==a.which&&a.preventDefault()}),$(document).keypress(function(a){"13"==a.which&&a.preventDefault()}),function(a){a.fn.addSearch=function(a){this.filter("div").each(function(){new conceptDetails(this,a)})}}(jQuery);var idSequence=0;!function(a){a.fn.addTaxonomy=function(a){this.filter("div").each(function(){new conceptDetails(this,a)})}}(jQuery);